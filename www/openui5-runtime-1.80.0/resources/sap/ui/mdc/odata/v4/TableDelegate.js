/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/TableDelegate","sap/ui/mdc/odata/v4/BaseDelegate",'sap/ui/core/Core','sap/ui/mdc/util/FilterUtil','sap/ui/mdc/odata/v4/util/DelegateUtil','sap/ui/mdc/condition/FilterConverter'],function(T,B,C,F,D,a){"use strict";var O=Object.assign({},T,B);O.fetchProperties=function(t){var m=t.getDelegate().payload,p=[],P,o,e,M,b,c;e="/"+m.collectionName;M=t.getModel(m.model);b=M.getMetaModel();return Promise.all([b.requestObject(e+"/"),b.requestObject(e+"@")]).then(function(r){var E=r[0],d=r[1];var s=d["@Org.OData.Capabilities.V1.SortRestrictions"]||{};var n=(s["NonSortableProperties"]||[]).map(function(f){return f["$PropertyPath"];});for(var k in E){o=E[k];if(o&&o.$kind==="Property"){c=b.getObject(e+"/"+k+"@");P={name:k,label:c["@com.sap.vocabularies.Common.v1.Label"],description:c["@com.sap.vocabularies.Common.v1.Text"]&&c["@com.sap.vocabularies.Common.v1.Text"].$Path,maxLength:o.$MaxLength,precision:o.$Precision,scale:o.$Scale,type:o.$Type,sortable:n.indexOf(k)==-1,filterable:true};p.push(P);}}return p;});};O.updateBindingInfo=function(m,M,b){if(!m){return;}if(M&&b){b.path=b.path||M.collectionPath||"/"+M.collectionName;b.model=b.model||M.model;}if(!b){b={};}var f=C.byId(m.getFilter()),c=m._getFilterEnabled(),d;if(c){d=m.getConditions();var e=a.createFilters(d);b.filters=e;}else if(f){d=f.getConditions();if(d){var p=f.getPropertyInfoSet?f.getPropertyInfoSet():null;var P=D.getParameterNames(f);var o=F.getFilterInfo(f,d,p,P);if(o){b.filters=o.filters;}var s=D.getParametersInfo(f,d);if(s){b.path=s;}}var S=f.getSearch();if(S){if(!b.parameters){b.parameters={};}b.parameters.$search=S;}}};return O;});
