/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Core','./Control','./library','sap/m/library','sap/ui/events/KeyCodes','./ActionToolbar','sap/m/Title','sap/ui/core/format/NumberFormat','sap/ui/model/Sorter','sap/ui/core/dnd/DragDropInfo',"./table/TableSettings","./table/GridTableType","./table/ResponsiveTableType","sap/m/ColumnHeaderPopover","sap/ui/core/Item","sap/m/ColumnPopoverSortItem",'sap/ui/dom/containsOrEquals','sap/base/strings/capitalize','sap/base/util/UriParameters'],function(C,a,l,M,K,A,T,N,S,D,b,G,R,c,I,d,e,f,g){"use strict";var h=l.SelectionMode;var j=l.TableType;var k=l.RowAction;var F="sap.ui.mdc.IFilter";function s(i,v){sap.ui.require(["sap/m/MessageToast"],function(n){var r=C.getLibraryResourceBundle("sap.ui.mdc");n.show(r.getText(i,v));});}var m=a.extend("sap.ui.mdc.Table",{library:"sap.ui.mdc",metadata:{designtime:"sap/ui/mdc/designtime/table/Table.designtime",interfaces:["sap.ui.mdc.IFilterSource","sap.ui.mdc.IxState"],defaultAggregation:"columns",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},rowAction:{type:"sap.ui.mdc.RowAction[]"},p13nMode:{type:"sap.ui.mdc.TableP13nMode[]"},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/TableDelegate",payload:{}}},rowsBindingInfo:{type:"object",defaultValue:null},autoBindOnInit:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},initiallyVisibleFields:{type:"string[]"},selectionMode:{type:"sap.ui.mdc.SelectionMode",defaultValue:h.None},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},threshold:{type:"int",group:"Appearance",defaultValue:-1},noDataText:{type:"string"},sortConditions:{type:"object"},filterConditions:{type:"object",defaultValue:{}},enableExport:{type:"boolean",defaultValue:false}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},type:{type:"sap.ui.mdc.table.TableTypeBase",altTypes:["sap.ui.mdc.TableType"],multiple:false},columns:{type:"sap.ui.mdc.table.Column",multiple:true},creationRow:{type:"sap.ui.mdc.table.CreationRow",multiple:false},actions:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_createToolbar",aggregation:"actions"}},variant:{type:"sap.ui.fl.variants.VariantManagement",multiple:false},quickFilter:{type:"sap.ui.core.Control",multiple:false},rowSettings:{type:"sap.ui.mdc.table.RowSettings",multiple:false}},associations:{filter:{type:F,multiple:false}},events:{rowPress:{parameters:{bindingContext:{type:"sap.ui.model.Context"}}},selectionChange:{parameters:{bindingContext:{type:"sap.ui.model.Context"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},paste:{parameters:{data:{type:"string[][]"}}}}},constructor:function(){this._oTableReady=new Promise(this._resolveTable.bind(this));this._oAdaptationController=null;a.apply(this,arguments);this.bCreated=true;this._doOneTimeOperations();this._initializeContent();},renderer:{apiVersion:2,render:function(r,o){r.openStart("div",o);r.class("sapUiMdcTable");r.style("height",o.getHeight());r.style("width",o.getWidth());r.openEnd();r.renderControl(o.getAggregation("_content"));r.close("div");}}});var t=["variant","quickFilter"];t.forEach(function(i){var n=f(i),p="_o"+n,o="get"+n,q="set"+n,r="destroy"+n;m.prototype[o]=function(){return this[p];};m.prototype[r]=function(){var u=this[p];this[q]();if(u){u.destroy();}return this;};m.prototype[q]=function(u){this.validateAggregation(i,u,false);var v=this._createToolbar(),w=u!==this[p];if(!u||w){v.removeBetween((this[o]()));this[p]=u;}if(w&&u){this._setToolbarBetween(v);}return this;};});m.prototype.init=function(){a.prototype.init.apply(this,arguments);this.mSkipPropagation={rowSettings:true};};m.prototype.applySettings=function(){a.prototype.applySettings.apply(this,arguments);this.initControlDelegate();};m.prototype._setToolbarBetween=function(o){[this._oVariant,this._oQuickFilter].forEach(function(i){if(i){o.addBetween(i);}});};m.prototype.initialized=function(){return this._oTableReady;};m.prototype._resolveTable=function(r,i){this._fResolve=r;this._fReject=i;};m.prototype._getStringType=function(o){var i,n=i=o||this.getType();if(!n){i=j.Table;}else if(typeof n==="object"){i=n.isA("sap.ui.mdc.table.ResponsiveTableType")?j.ResponsiveTable:j.Table;}return i;};m.prototype._updateTypeSettings=function(){var o=this.getType();if(o&&typeof o==="object"){o.updateTableSettings();}else{o=o==="ResponsiveTable"?R:G;o.updateDefault(this._oTable);}};m.prototype.scrollToIndex=function(i){if(!this._oTable||(typeof i!=="number")){return;}if(this._getStringType()===j.ResponsiveTable){this._oTable.scrollToIndex(i);}else{if(i===-1){i=this.getRowBinding()?this.getRowBinding().getLength():0;}this._oTable.setFirstVisibleRow(i);}};m.prototype.setType=function(v){var i=this._getStringType(v);var o=this._getStringType();this.setAggregation("type",v,true);if(i===o&&this._oTable){this._updateTypeSettings();return this;}if(this.bCreated){if(this._oTable){if(o==="ResponsiveTable"){this._oTable.setHeaderToolbar();}else{this._oTable.removeExtension(this._oToolbar);}this._oTable.destroy("KeepDom");this._oTable=null;this._bTableExists=false;}else{this._onAfterTableCreated();}if(this._oTemplate){this._oTemplate.destroy();this._oTemplate=null;}this._oTableReady=new Promise(this._resolveTable.bind(this));this._initializeContent();}return this;};m.prototype.setRowSettings=function(r){var i=this._getStringType();this.setAggregation("rowSettings",r,true);if(this._oTable){if(i==="ResponsiveTable"){R.updateRowSettings(this._oTemplate,r);this.checkAndRebindTable();}else{G.updateRowSettings(this._oTable,r);}}return this;};m.prototype.focus=function(o){var i=this.getDomRef();if(this._oTable&&i&&!e(i,document.activeElement)){this._oTable.focus();}};m.prototype.setBusy=function(B){this.setProperty('busy',B,true);if(this._oTable){this._oTable.setBusy(B);}return this;};m.prototype.setSelectionMode=function(i){var o=this.getSelectionMode();this.setProperty("selectionMode",i,true);if(this._oTable&&o!=this.getSelectionMode()){this._updateSelectionBehavior();}return this;};m.prototype.setRowAction=function(i){var o=this.getRowAction();this.setProperty("rowAction",i,true);if(((i&&i.length)!=(o&&o.length))||o[0]!=i[0]){this._updateRowAction();}return this;};m.prototype.setCreationRow=function(o){this.setAggregation("creationRow",o,true);if(o){o.update();}return this;};m.prototype.setP13nMode=function(i){var o=this.getP13nMode();this.setProperty("p13nMode",i,true);this._updatep13nSettings(o,i);return this;};m.prototype.setFilterConditions=function(i){this.setProperty("filterConditions",i,true);if(this._oP13nFilter){this._oP13nFilter.setFilterConditions(i);}return this;};m.prototype.setThreshold=function(i){this.setProperty("threshold",i,true);if(!this._oTable){return this;}i=this.getThreshold()>-1?this.getThreshold():undefined;if(this._bMobileTable){this._oTable.setGrowingThreshold(i);}else{this._oTable.setThreshold(i);}return this;};m.prototype.setNoDataText=function(n){this.setProperty("noDataText",n,true);this._updateInnerTableNoDataText();return this;};m.prototype._updateInnerTableNoDataText=function(){if(!this._oTable){return;}var n=this._getNoDataText();if(this._bMobileTable){this._oTable.setNoDataText(n);}else{this._oTable.setNoData(n);}};m.prototype._getNoDataText=function(){var n=this.getNoDataText();if(n){return n;}var r=C.getLibraryResourceBundle("sap.ui.mdc");if(!this.isTableBound()){if(this.getFilter()){return r.getText("table.NO_DATA_WITH_FILTERBAR");}return r.getText("table.NO_DATA");}return r.getText("table.NO_RESULTS");};m.prototype._updateRowAction=function(){if(!this._oTable){return;}var n=(this.getRowAction()||[]).indexOf(k.Navigation)>-1;var o=this._bMobileTable?R:G;o.updateRowAction(this,n,this._bMobileTable?undefined:this._onRowActionPress);};m.prototype._initializeContent=function(){var i=this._getStringType();var o=i==="ResponsiveTable"?R:G;Promise.all([this.awaitControlDelegate(),o.loadTableModules()]).then(function(){if(this.bIsDestroyed){return;}if(!this._bTableExists&&i===this._getStringType()){this._bMobileTable=i==="ResponsiveTable";this._createContent();this._bTableExists=true;}}.bind(this));};m.prototype._doOneTimeOperations=function(){if(!this.bColumnsOrdered){this.bColumnsOrdered=true;this._orderColumns();}};m.prototype._onAfterTableCreated=function(r){if(r&&this._fResolve){this._fResolve(this);}else if(this._fReject){this._fReject(this);}delete this._fResolve;delete this._fReject;};m.prototype._createContent=function(){this._createToolbar();this._createTable();this._updateRowAction();var i=this.getColumns();i.forEach(this._insertInnerColumn,this);this.setAggregation("_content",this._oTable);this._onAfterTableCreated(true);this.initialized().then(function(){var o=this.getCreationRow();if(o){o.update();}if(this.getAutoBindOnInit()){this.checkAndRebindTable();}}.bind(this));};m.prototype.setHeader=function(i){this.setProperty("header",i,true);this._updateHeaderText();this._updateExportState(true);return this;};m.prototype.setHeaderVisible=function(v){this.setProperty("headerVisible",v,true);if(this._oTitle){this._oTitle.setWidth(this.getHeaderVisible()?undefined:"0px");}return this;};m.prototype.setEnableExport=function(E){if(E!==this.getEnableExport()){this.setProperty("enableExport",E,true);if(E&&!this._oExportButton&&this._oToolbar){this._oToolbar.addEnd(this._getExportButton());}else if(this._oExportButton){this._oExportButton.setVisible(E);}}return this;};m.prototype._createToolbar=function(){if(!this._oToolbar){this._oTitle=new T(this.getId()+"-title",{text:this.getHeader(),width:this.getHeaderVisible()?undefined:"0px"});this._oToolbar=new A(this.getId()+"-toolbar",{design:"Transparent",begin:[this._oTitle],end:[this._getP13nButtons(),this._getExportButton()]});}return this._oToolbar;};m.prototype._getVisibleProperties=function(){var p=[],L;this.getColumns().forEach(function(o,i){L=o&&o.getDataProperties()[0];if(L){p.push({name:L});}});return p;};m.prototype.getConditions=function(){return this._oP13nFilter?this._oP13nFilter.getConditions():[];};m.prototype._getSortedProperties=function(){return this.getSortConditions()?this.getSortConditions().sorters:[];};m.prototype.getCurrentState=function(){var o={items:this._getVisibleProperties(),sorters:this._getSortedProperties()};if(this._getFilterEnabled()){o.filter=this.getFilterConditions();}return o;};m.prototype._getFilterEnabled=function(){var u=new g(window.location.search);var E=u.getAll("sap-ui-xx-p13nFilter")[0]==="true";if(this._bFilterEnabled||(this.getP13nMode()&&this.getP13nMode().indexOf("Filter")>-1&&E)){return true;}else{return false;}};m.prototype._getP13nButtons=function(){var p=this.getP13nMode()||[],B=[];if(p.length>0){if(p.indexOf("Sort")>-1){B.push(b.createSortButton(this.getId(),[this._showSort,this]));}if(this._getFilterEnabled()){B.push(b.createFilterButton(this.getId(),[this._showFilter,this]));}if(p.indexOf("Column")>-1){B.push(b.createColumnsButton(this.getId(),[this._showSettings,this]));}}return B;};m.prototype._getExportButton=function(){if(!this.getEnableExport()){return null;}var i={fileName:this.getHeader()};if(!this._cachedExportSettings){this._cachedExportSettings=i;}if(!this._oExportButton){this._oExportButton=b.createExportButton(this.getId(),{"default":[function(){this._onExport(i);},this],"exportAs":[this._onExportAs,this]});}this._updateExportState();return this._oExportButton;};m.prototype._updateExportState=function(u){var r=this._getRowBinding();if(this._oExportButton){this._oExportButton.setEnabled(!!(r&&r.getLength()>0));if(u&&this._cachedExportSettings){this._cachedExportSettings.fileName=this.getHeader();}}};m.prototype._createExportSettingsObject=function(o,E){return Object.assign({columnId:o.getId(),label:o.getHeader(),width:this._getColumnWidthNumber(o.getWidth()),textAlign:o.getHAlign(),type:"String"},E);};m.prototype._createExportColumnConfiguration=function(i){var n=i&&i.splitCells;var o=this.getColumns();return this.getControlDelegate().fetchProperties(this).then(function(p){var P={},q=[],r,u,v,w,E,x,y,z;p.forEach(function(B){P[B.name]=B;});o.forEach(function(B){u=null;v=null;w=[];r=B.getDataProperties();E=null;x=[];y=null;z=null;u=P[r[0]];if(u){if(u.hasOwnProperty("propertyInfos")&&u.propertyInfos.length){v=u.propertyInfos;v.forEach(function(H){w.push(P[H]);});if(!n&&u.hasOwnProperty("exportSettings")){E=this._createExportSettingsObject(B,u.exportSettings);w.forEach(function(H){x.push(H.path||H.name);});E.property=x;q.push(E);}else{w.forEach(function(H,J){var L=this._createExportSettingsObject(B,H.exportSettings);L.property=H.path||H.name;if(!H.exportSettings||!H.exportSettings.label){L.label=H.label||B.getHeader()+(J>0?" ("+(J+1)+")":"");}q.push(L);},this);}}else if(!n&&u.hasOwnProperty("exportSettings")){E=this._createExportSettingsObject(B,u.exportSettings);E.property=u.path||u.name;q.push(E);}else{E=this._createExportSettingsObject(B,u.exportSettings);E.property=u.path||u.name;E.displayUnit=!n?true:false;q.push(E);y=n&&E&&E.unitProperty?E.unitProperty:null;if(y){z=P[y];if(!z){z=p.find(function(H){return y===H.path;});}E=this._createExportSettingsObject(B,z.exportSettings);E.property=z.path||z.name;E.columnId=B.getId()+"-additionalProperty";if(!z.exportSettings||!z.exportSettings.label){E.label=z.label||B.getHeader()+" (2)";}q.push(E);}}}},this);return[q,p];}.bind(this));};m.prototype._getColumnWidthNumber=function(w){if(w.indexOf("em")>0){return Math.round(parseFloat(w));}if(w.indexOf("px")>0){return Math.round(parseInt(w)/16);}return"";};m.prototype._getColumnHeader=function(p){if(!p){return null;}var o=this.getColumns().find(function(i){return i.getDataProperties()[0]===p;});return o?o.getHeader():null;};m.prototype._onExport=function(i){return this._createExportColumnConfiguration(i).then(function(r){var n=r[0];if(!n||!n.length){sap.ui.require(["sap/m/MessageBox"],function(q){q.error(C.getLibraryResourceBundle("sap.ui.mdc").getText("table.NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});}.bind(this));return;}var o=this._getRowBinding();var p=function(P){var q=r[1];var u=q.find(function(v){return v.name===P;});return u.label||u.name||null;};var E={workbook:{columns:n},dataSource:o,fileName:i?i.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(["sap/ui/export/ExportUtils","sap/ui/export/Spreadsheet"],function(q,u){var P=Promise.resolve();if(i.includeFilterSettings){P=q.parseFilterConfiguration(o,p).then(function(v){if(v){E.workbook.context={metaSheetName:v.name,metainfo:[v]};}});}P.then(function(){var U={splitCells:false,includeFilterSettings:false};if(i){U.splitCells=i.splitCells;U.includeFilterSettings=i.includeFilterSettings;}var v=new u(E);v.attachBeforeExport(function(w){this.fireBeforeExport({exportSettings:w.getParameter("exportSettings"),userExportSettings:U});},this);v.build().finally(function(){v.destroy();});}.bind(this));}.bind(this));}.bind(this));}.bind(this));};m.prototype._onExportAs=function(){var i=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(E){E.getExportSettingsViaDialog(i._cachedExportSettings,i).then(function(u){i._cachedExportSettings=u;i._onExport(u);});});});};m.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=C.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};m.prototype.onkeydown=function(E){if(E.isMarked()){return;}if((E.metaKey||E.ctrlKey)&&E.shiftKey&&E.which===K.E){if(this.getEnableExport()&&this._oExportButton&&this._oExportButton.getEnabled()){this._onExportAs();E.setMarked();E.preventDefault();}}};m.prototype._updatep13nSettings=function(o,i){if(this._oToolbar){this._oToolbar.destroyEnd();var B=this._getP13nButtons();B.forEach(function(p){this._oToolbar.addEnd(p);},this);}if(this._oTable){var n=this._oTable.getDragDropConfig()[0];if(n){n.setEnabled((i||[]).indexOf("Column")>-1);}}};m.prototype._createTable=function(){var i=this.getThreshold()>-1?this.getThreshold():undefined,r=this.getRowSettings()?this.getRowSettings().getAllSettings():{};if(this._bMobileTable){this._oTable=R.createTable(this.getId()+"-innerTable",{autoPopinMode:true,growing:true,sticky:["ColumnHeaders","HeaderToolbar"],itemPress:[this._onItemPress,this],selectionChange:[this._onSelectionChange,this],growingThreshold:i,noDataText:this._getNoDataText(),headerToolbar:this._oToolbar,ariaLabelledBy:[this._oTitle]});this._oTemplate=R.createTemplate(this.getId()+"-innerTableRow",r);this._createColumn=m.prototype._createMobileColumn;this._sAggregation="items";this._oTable.bindRows=this._oTable.bindItems;this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onResponsiveTableColumnPress,this);}else{this._oTable=G.createTable(this.getId()+"-innerTable",{enableBusyIndicator:true,enableColumnReordering:false,threshold:i,cellClick:[this._onCellClick,this],noData:this._getNoDataText(),extension:[this._oToolbar],ariaLabelledBy:[this._oTitle],plugins:[G.createMultiSelectionPlugin(this,[this._onRowSelectionChange,this])],columnSelect:[this._onGridTableColumnPress,this],rowSettingsTemplate:r});this._createColumn=m.prototype._createColumn;this._sAggregation="rows";}this._updateTypeSettings();this._updateSelectionBehavior();var o=new D({sourceAggregation:"columns",targetAggregation:"columns",dropPosition:"Between",enabled:(this.getP13nMode()||[]).indexOf("Column")>-1,drop:[this._onColumnRearrange,this]});o.bIgnoreMetadataCheck=true;this._oTable.addDragDropConfig(o);this._oTable.attachPaste(this._onInnerTablePaste,this);};m.prototype._updateSelectionBehavior=function(){var o=this._bMobileTable?R:G;o.updateSelection(this);};m.prototype._onColumnRearrange=function(E){var o=E.getParameter("draggedControl");var i=E.getParameter("droppedControl");if(o===i){return;}var n=E.getParameter("dropPosition");var p=this._oTable.indexOfColumn(o);var q=this._oTable.indexOfColumn(i);var r=q+(n=="Before"?0:1)+(p<q?-1:0);b.moveColumn(this,p,r);};m.prototype._onColumnPress=function(o){var p=this.getP13nMode()||[];if(p.indexOf("Sort")<0){return;}var n;if(o.getParent()){n=o.getParent().indexOfColumn(o);}var q=this.getColumns()[n].getDataProperties(),r;if(!q.length){return;}this.getControlDelegate().fetchProperties(this).then(function(P){r=P.filter(function(w){return q.indexOf(w.name)>=0&&w.sortable;});if(r.length===0){return;}var u,v=[];for(var i=0;i<r.length;i++){u=new I({text:r[i].name,key:r[i].name});v.push(u);}if(v.length>0){if(this._oPopover){this._oPopover.destroy();}this._oPopover=new c({items:[new d({items:v,sort:[this._onCustomSort,this]})]});this._oPopover.openBy(o);o.addDependent(this._oPopover);}}.bind(this));};m.prototype._onCustomSort=function(E){var i=E.getParameter("property");b.createSort(this,i,true);};m.prototype._insertInnerColumn=function(o,i){if(!this._oTable){return;}var n=this._createColumn(o);this._setColumnTemplate(o,n,i);if(i===undefined){this._oTable.addColumn(n);}else{this._oTable.insertColumn(n,i);}};m.prototype._orderColumns=function(){var i,n=[],o=this.getColumns();o.forEach(function(p){i=p.getInitialIndex();if(i>-1){n.push({index:i,column:this.removeColumn(p)});}},this);n.sort(function(p,q){return p-q;});n.forEach(function(p){this.insertColumn(p.column,p.index);},this);};m.prototype._setColumnTemplate=function(o,i,n){var p=o.getTemplate(true),q;if(!this._bMobileTable){q=o.getCreationTemplate(true);[p,q].forEach(function(r){if(!r){return;}if(r.setWrapping){r.setWrapping(false);}if(r.setRenderWhitespace){r.setRenderWhitespace(false);}});i.setTemplate(p);i.setCreationTemplate(q);}else if(n>=0){this._oTemplate.insertCell(p,n);}else{this._oTemplate.addCell(p);}};m.prototype._createColumn=function(o){return G.createColumn(o.getId()+"-innerColumn",{width:o.getWidth(),minWidth:Math.round(o.getMinWidth()*parseFloat(M.BaseFontSize)),hAlign:o.getHAlign(),label:o.getColumnHeaderControl(this._bMobileTable),showSortMenuEntry:false,showFilterMenuEntry:false,sortProperty:o.getDataProperties()[0],filterProperty:o.getDataProperties()[0]});};m.prototype._createMobileColumn=function(o){return R.createColumn(o.getId()+"-innerColumn",{width:o.getWidth(),autoPopinWidth:o.getMinWidth(),hAlign:o.getHAlign(),header:o.getColumnHeaderControl(this._bMobileTable),importance:o.getImportance(),popinDisplay:"Inline"});};m.prototype.moveColumn=function(o,i){var n;this.removeAggregation("columns",o,true);this.insertAggregation("columns",o,i,true);if(this._oTable){n=this._oTable.removeColumn(o.getId()+"-innerColumn");this._oTable.insertColumn(n,i);if(this._bMobileTable){this._updateColumnTemplate(o,i);}}};m.prototype.removeColumn=function(o){o=this.removeAggregation("columns",o,true);if(this._oTable){var i=this._oTable.removeColumn(o.getId()+"-innerColumn");i.destroy();if(this._bMobileTable){this._updateColumnTemplate(o,-1);}}return o;};m.prototype.addColumn=function(o){this.addAggregation("columns",o,true);this._insertInnerColumn(o);return this;};m.prototype.insertColumn=function(o,i){this.insertAggregation("columns",o,i,true);this._insertInnerColumn(o,i);return this;};m.prototype._updateColumnTemplate=function(o,i){var n,p;if(this._oTemplate){n=o.getTemplate(true);p=this._oTemplate.indexOfCell(n);m._removeItemCell(this._oTemplate,p,i);}if(p>-1){this._oTable.getItems().forEach(function(q){if(q.removeCell){m._removeItemCell(q,p,i);}});}};m._removeItemCell=function(i,r,n){var o=i.removeCell(r);if(o){if(n>-1){i.insertCell(o,n);}else{o.destroy();}}};m.prototype._onItemPress=function(E){this.fireRowPress({bindingContext:E.getParameter("listItem").getBindingContext()});};m.prototype._onSelectionChange=function(E){var i=E.getParameter("selectAll");this.fireSelectionChange({bindingContext:E.getParameter("listItem").getBindingContext(),selected:E.getParameter("selected"),selectAll:i});if(i){var r=this.getRowBinding();if(r&&this._oTable){var B=r.getLength();var n=this._oTable.getItems().length;var o=r.isLengthFinal();if(n!=B||!o){s("table.SELECTION_LIMIT_MESSAGE",[n]);}}}};m.prototype._onResponsiveTableColumnPress=function(E){this._onColumnPress(E.getParameter("column"));};m.prototype._onCellClick=function(E){this.fireRowPress({bindingContext:E.getParameter("rowBindingContext")});};m.prototype._onRowActionPress=function(E){var r=E.getParameter("row");this.fireRowPress({bindingContext:r.getBindingContext()});};m.prototype._onRowSelectionChange=function(E){if(!this._bSelectionChangedByAPI){this.fireSelectionChange({bindingContext:E.getParameter("rowContext"),selected:E.getSource().isIndexSelected(E.getParameter("rowIndex")),selectAll:E.getParameter("selectAll")});}};m.prototype._onGridTableColumnPress=function(E){E.preventDefault();this._onColumnPress(E.getParameter("column"));};m.prototype.getSelectedContexts=function(){if(this._oTable){if(this._bMobileTable){return this._oTable.getSelectedContexts();}var i=this._oTable.getPlugins()[0].getSelectedIndices();return i.map(function(n){return this._oTable.getContextByIndex(n);},this);}return[];};m.prototype.clearSelection=function(){if(this._oTable){if(this._bMobileTable){this._oTable.removeSelections(true);}else{this._bSelectionChangedByAPI=true;this._oTable.getPlugins()[0].clearSelection();this._bSelectionChangedByAPI=false;}}};m.prototype.setFilter=function(v){if(this._validateFilter(v)){this._deregisterFilter();this.setAssociation("filter",v,true);this._registerFilter();this._updateInnerTableNoDataText();}return this;};m.prototype._validateFilter=function(v){var o=typeof v==="object"?v:C.byId(v);if(!o||o.isA(F)){return true;}throw new Error("\""+v+"\" is not valid for association \"filter\" of mdc.Table. Please use an object that implements \""+F+"\" interface");};m.prototype._deregisterFilter=function(){var o=C.byId(this.getFilter());if(o){o.detachSearch(this.rebindTable,this);o.detachFiltersChanged(this._onFiltersChanged,this);}};m.prototype._registerFilter=function(){var o=C.byId(this.getFilter());if(o){o.attachSearch(this.rebindTable,this);o.attachFiltersChanged(this._onFiltersChanged,this);}};m.prototype._registerInnerFilter=function(o){this._deregisterFilter();o.attachSearch(this.rebindTable,this);o.attachFiltersChanged(this._onFiltersChanged,this);};m.prototype._onFiltersChanged=function(E){if(this.isTableBound()&&E.getParameter("conditionsBased")){this._oTable.setShowOverlay(true);}};m.prototype.isTableBound=function(){return this._oTable?this._oTable.isBound(this._bMobileTable?"items":"rows"):false;};m.prototype.bindRows=function(B){if(!this.bDelegateInitialized||!this._oTable){return;}this.getControlDelegate().updateBindingInfo(this,this.getPayload(),B);if(B&&B.path){this._oTable.setShowOverlay(false);if(this._bMobileTable&&this._oTemplate){B.template=this._oTemplate;}else{delete B.template;}if(!B.parameters){B.parameters={};}B.sorter=this._getSorters();if(this.getShowRowCount()){m._addBindingListener(B,"dataReceived",this._onDataReceived.bind(this));m._addBindingListener(B,"change",this._updateHeaderText.bind(this));}this._updateColumnsBeforeBinding(B);this.getControlDelegate().rebindTable(this,B);this._updateInnerTableNoDataText();}return this;};m.prototype._onDataReceived=function(E){if(E&&E.getParameter&&E.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._updateHeaderText();this._updateExportState();};m.prototype._updateHeaderText=function(){var H,r;if(this._oTitle&&this.getHeader()){H=this.getHeader();if(this.getShowRowCount()){r=this._getRowCount();if(r){H+=" ("+r+")";}}this._oTitle.setText(H);}};m.prototype._updateColumnsBeforeBinding=function(B){var i=[].concat(B.sorter||[]);var n=this.getColumns();var o=this._bMobileTable;n.forEach(function(p){var q=C.byId(p.getId()+"-innerColumn");if(o){q.setSortIndicator("None");}else{q.setSorted(false);}});i.forEach(function(p){var q=(p.bDescending)?"Descending":"Ascending";n.some(function(r){var u=C.byId(r.getId()+"-innerColumn");if(r.getDataProperties().indexOf(p.sPath)>-1){if(o){u.setSortIndicator(q);}else{u.setSorted(true).setSortOrder(q);}return true;}});});};m.prototype._getRowCount=function(){var r=this.getRowBinding(),i,v="";if(r){i=r.getLength();if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}if(r.isLengthFinal()){v=this._oNumberFormatInstance.format(i);}}return v;};m.prototype.getRowBinding=function(){return this._getRowBinding();};m.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};m._addBindingListener=function(B,E,H){if(!B.events){B.events={};}if(!B.events[E]){B.events[E]=H;}else{var o=B.events[E];B.events[E]=function(){H.apply(this,arguments);o.apply(this,arguments);};}};m.prototype.rebindTable=function(){if(this._bTableExists){this.bindRows(this.getRowsBindingInfo()||{});}else{this.initialized().then(this.rebindTable.bind(this));}};m.prototype.checkAndRebindTable=function(){if(this._getFilterEnabled()){this._retrieveP13nFilter().then(function(o){o.triggerSearch();});}else{var o=C.byId(this.getFilter());if(o){o.triggerSearch();}else{this.rebindTable();}}};m.prototype._showSettings=function(E){b.showPanel(this,"Columns",E.getSource());};m.prototype._showSort=function(E){b.showPanel(this,"Sort",E.getSource());};m.prototype._showFilter=function(E){b.showPanel(this,"Filter",E.getSource());};m.prototype.getAdaptationConfig=function(i){return b._getAdaptationController(this)["get"+i+"Config"]();};m.prototype._retrieveP13nFilter=function(){return new Promise(function(r,i){if(!this._oP13nFilter){sap.ui.require(["sap/ui/mdc/filterbar/p13n/AdaptationFilterBar"],function(n){this._oP13nFilter=new n(this.getId()+"-p13nFilter",{liveMode:true,adaptationControl:this,filterConditions:this.getFilterConditions(),delegate:this.getControlDelegate().getFilterDelegate(this.getDelegate().payload)});this._registerInnerFilter(this._oP13nFilter);this.addDependent(this._oP13nFilter);r(this._oP13nFilter);}.bind(this));}else{r(this._oP13nFilter);}}.bind(this));};m.prototype._getSorters=function(){var i=this.getSortConditions()?this.getSortConditions().sorters:[];var n=[];i.forEach(function(o){n.push(new S(o.name,o.descending));});return n;};m.prototype._onInnerTablePaste=function(E){this.firePaste({data:E.getParameter("data")});};m.prototype.exit=function(){var i=this;if(this._oTemplate){this._oTemplate.destroy();}if(this._oAdaptationController){this._oAdaptationController.destroy();this._oAdaptationController=null;}this._oP13nFilter=null;this._oTemplate=null;this._oTable=null;this._oToolbar=null;this._oTitle=null;this._oNumberFormatInstance=null;t.forEach(function(n){var o=f(n),p="_o"+o;i[p]=null;});this._oTableReady=null;this._fReject=null;this._fResolve=null;a.prototype.exit.apply(this,arguments);};return m;});
