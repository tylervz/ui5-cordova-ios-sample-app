/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/library','sap/ui/mdc/p13n/AdaptationController','sap/ui/mdc/p13n/FlexUtil','sap/ui/Device','sap/ui/mdc/Control','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/base/Log','sap/ui/mdc/condition/ConditionModel','sap/ui/mdc/condition/Condition','sap/ui/mdc/util/IdentifierUtil','sap/ui/mdc/condition/ConditionConverter','sap/m/MessageBox',"sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/mdc/p13n/StateUtil","sap/ui/mdc/condition/FilterConverter","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/mdc/util/FilterUtil"],function(c,A,F,D,C,m,d,M,a,L,b,e,I,f,g,h,j,S,k,l,n){"use strict";var V=c.ValueState;var o=C.extend("sap.ui.mdc.filterbar.FilterBarBase",{metadata:{library:"sap.ui.mdc",defaultAggregation:"filterItems",interfaces:["sap.ui.mdc.IFilter","sap.ui.mdc.IxState"],properties:{delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/FilterBarDelegate",payload:{modelName:undefined,collectionName:""}}},liveMode:{type:"boolean",defaultValue:false},showMessages:{type:"boolean",group:"Misc",defaultValue:true},showGoButton:{type:"boolean",defaultValue:true},filterConditions:{type:"object",defaultValue:{}},suspendSelection:{type:"boolean",defaultValue:false},_filterCount:{type:"string",visibility:"hidden"}},aggregations:{filterItems:{type:"sap.ui.mdc.FilterField",multiple:true},basicSearchField:{type:"sap.ui.mdc.FilterField",multiple:false},layout:{type:"sap.ui.mdc.filterbar.IFilterContainer",multiple:false,visibility:"hidden"}},associations:{variantBackreference:{type:"sap.ui.fl.variants.VariantManagement",multiple:false}},events:{search:{conditions:{type:"object"}},filtersChanged:{conditionsBased:{type:"boolean"},filtersText:{type:"string"},filtersTextExpanded:{type:"string"}}}}});o.INNER_MODEL_NAME="$sap.ui.filterbar.mdc.FilterBarBase";o.CONDITION_MODEL_NAME="$filters";var E={NoError:-1,RequiredHasNoValue:0,FieldInErrorState:1,AsyncValidation:2};o.prototype.init=function(){C.prototype.init.apply(this,arguments);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._createInnerModel();this._oObserver=new a(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["filterItems"]});this._createInnerLayout();this.bPersistValues=false;this._aProperties=null;this._fResolveInitialFiltersApplied=undefined;this._oInitialFiltersAppliedPromise=new Promise(function(r){this._fResolveInitialFiltersApplied=r;}.bind(this));this._bIgnoreChanges=false;this._oAdaptationController=null;this._bSearchTriggered=false;};o.prototype._createInnerLayout=function(){this._cLayoutItem=null;this._oFilterBarLayout=null;this.setAggregation("layout",this._oFilterBarLayout,true);};o.prototype._createInnerLayout=function(){this._cLayoutItem=null;this._oFilterBarLayout=null;this.setAggregation("layout",this._oFilterBarLayout,true);};o.prototype._isPhone=function(){return(D.system.phone)?true:false;};o.prototype._isLiveMode=function(){if(this._isPhone()){return false;}return this.getLiveMode();};o.prototype._getConditionModel=function(){return this._oConditionModel;};o.prototype.getConditionModelName=function(){return this._getConditionModelName();};o.prototype._getConditionModelName=function(){return o.CONDITION_MODEL_NAME;};o.prototype._createConditionModel=function(){this._oConditionModel=new b();this.setModel(this._oConditionModel,this._getConditionModelName());};o.prototype.applySettings=function(s,i){C.prototype.applySettings.apply(this,arguments);this._createConditionModel();this._oConditionModel.attachPropertyChange(this._handleConditionModelPropertyChange,this);this._retrieveMetadata().then(function(){this._applyInitialFilterConditions();}.bind(this));};o.prototype.setSuspendSelection=function(v){this.setProperty("suspendSelection",v);if(!v){if(this._bSearchTriggered){this._bSearchTriggered=false;this.triggerSearch();}}return this;};o.prototype._createInnerModel=function(){this._oModel=new M(this);this.setModel(this._oModel,o.INNER_MODEL_NAME);return this;};o.prototype.onAdaptFilters=function(i){return this._oMetadataAppliedPromise.then(function(){return this._getAdaptationController().showP13n(this._btnAdapt,"Item");}.bind(this));};o.prototype.setFilterConditions=function(v,s){S.checkConditionOperatorSanity(v);this.setProperty("filterConditions",v,s);return this;};o.prototype.getCurrentState=function(){var i=this.getFilterItems();var p=[];i.forEach(function(s,t){p.push({name:s.getFieldPath()});});var q=[];var r=this.getFilterConditions();for(var K in r){if(!this._getPropertyByName(K)){q.push(K);}}q.forEach(function(K){delete r[K];});return{filter:r,items:p};};o.prototype.getAdaptationConfig=function(s){return this._getAdaptationController()["get"+s+"Config"]();};o.prototype._getAdaptationController=function(){if(!this._oAdaptationController){this._oAdaptationController=new A({liveMode:true,stateRetriever:function(i,p){return this.getCurrentState(p);},adaptationControl:this,afterChangesCreated:function(i,p){F.handleChanges(p);},retrievePropertyInfo:this._getNonHiddenPropertyInfoSet,itemConfig:{addOperation:"addFilter",removeOperation:"removeFilter",moveOperation:"moveFilter",panelPath:"sap/ui/mdc/p13n/panels/AdaptFiltersPanel",title:this._oRb.getText("filterbar.ADAPT_TITLE")},filterConfig:{filterControl:this}});}return this._oAdaptationController;};o.prototype._getAssignedFilterNames=function(){var N,i=null,p=this._getConditionModel();if(p){i=[];var q=p.getConditions("$search");if(q&&q.length>0){i.push(this._oRb.getText("filterbar.ADAPT_SEARCHTERM"));}this._getNonHiddenPropertyInfoSet().forEach(function(P){N=I.getPropertyKey(P);var q=p.getConditions(N);if(q&&q.length>0){i.push(P.label||N);}});}return i;};o.prototype._getAssignedFiltersText=function(){var t={};t.filtersText=this._getAssignedFiltersCollapsedText(this._getAssignedFilterNames());t.filtersTextExpanded=this._getAssignedFiltersExpandedText();return t;};o.prototype._getAssignedFiltersExpandedText=function(){var i=0,p=0,q=this._getConditionModel();if(q){var r=q.getAllConditions();for(var s in r){var P=this._getPropertyByName(s);if(P&&!P.hiddenFilter&&(r[s].length>0)){++i;if(!(((s==="$search")&&this.getAggregation("basicSearchField"))||this._getFilterField(s))){++p;}}}}if(!i&&!p){return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");}if(!p){if(i===1){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_NON_HIDDEN",[i]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_NON_HIDDEN",[i]);}if((i===1)){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_HIDDEN",[i,p]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_HIDDEN",[i,p]);};o.prototype._getAssignedFiltersCollapsedText=function(p){var s;p=p||[];if(p.length){s=Object.keys(p).map(function(i){return p[i];}).join(", ");if(p.length===1){return this._oRb.getText("filterbar.ADAPT_FILTER_COLLAPSED",[p.length,s]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_COLLAPSED",[p.length,s]);}return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");};o.prototype.getAssignedFiltersText=function(){return this._getAssignedFiltersText();};o.prototype._reportModelChange=function(t){this._handleAssignedFilterNames();if(this.getLiveMode()||t){this.triggerSearch();}};o.prototype._isFlexSupported=function(i){return j.isFlexSupported({element:this});};o.prototype._handleConditionModelPropertyChange=function(i){if(!this._bIgnoreChanges){var p=i.getParameter("path");if(p.indexOf("/conditions/")===0){var s=p.substring("/conditions/".length);if(this.bPersistValues&&this._isFlexSupported()){var O={};O[s]=this._stringifyConditions(s,i.getParameter("value"));this._cleanupConditions(O[s]);this._getAdaptationController().createConditionChanges(O);}else{this._reportModelChange(false);}}}};o.prototype._toExternal=function(p,i){var q=m({},i);q=f.toString(q,p.typeConfig,this.getTypeUtil());this._cleanupCondition(q);if(i.inParameters&&(Object.keys(i.inParameters).length>0)){Object.keys(i.inParameters).forEach(function(K){var r=this._getPropertyByName(K);if(r){var s=e.createCondition("EQ",[i.inParameters[K]]);var t=f.toString(s,r.typeConfig,this.getTypeUtil());if(!q.inParameters){q.inParameters={};}q.inParameters[K]=t.values[0];}else{L.error("mdc.FilterBar._toExternal: could not find property info for "+K);}}.bind(this));}if(i.outParameters&&(Object.keys(i.outParameters).length>0)){Object.keys(i.outParameters).forEach(function(K){var O=this._getPropertyByName(K);if(O){var r=e.createCondition("EQ",[i.outParameters[K]]);var s=f.toString(r,O.typeConfig,this.getTypeUtil());if(!q.outParameters){q.outParameters={};}q.outParameters[K]=s.values[0];}else{L.error("mdc.FilterBar._toExternal: could not find property info for "+K);}}.bind(this));}return q;};o.prototype._toInternal=function(p,i){var q=m({},i);q=f.toType(q,p.typeConfig,this.getTypeUtil());if(i.inParameters&&(Object.keys(i.inParameters).length>0)){Object.keys(i.inParameters).forEach(function(K){var r=this._getPropertyByName(K);if(r){var s=e.createCondition("EQ",[i.inParameters[K]]);var v=f.toType(s,r.typeConfig,this.getTypeUtil());if(!q.inParameters){q.inParameters={};}q.inParameters[K]=v.values[0];}else{L.error("mdc.FilterBar._toInternal: could not find property info for "+K);}}.bind(this));}if(i.outParameters&&(Object.keys(i.outParameters).length>0)){Object.keys(i.outParameters).forEach(function(K){var O=this._getPropertyByName(K);if(O){var r=e.createCondition("EQ",[i.outParameters[K]]);var v=f.toType(r,O.typeConfig,this.getTypeUtil());if(!q.outParameters){q.outParameters={};}q.outParameters[K]=v.values[0];}else{L.error("mdc.FilterBar._toInternal: could not find property info for "+K);}}.bind(this));}return q;};o.prototype._cleanupCondition=function(i){if(i){if(i.hasOwnProperty("isEmpty")){delete i.isEmpty;}}};o.prototype._cleanupConditions=function(i){if(i){i.forEach(function(p){this._cleanupCondition(p);},this);}};o.prototype._stringifyCondition=function(p,i){var r=i;if(i&&i.values){if(i.values.length>0){r=this._toExternal(p,i);}else{r=m({},i);this._cleanupCondition(r);}}return r;};o.prototype._stringifyConditions=function(s,i){var p=this._getPropertyByName(s);var r=i;if(p&&i){r=[];i.forEach(function(q){r.push(this._stringifyCondition(p,q));},this);}return r;};o.prototype._handleAssignedFilterNames=function(i){if(!this._oMetadataAppliedPromise){return;}this._oMetadataAppliedPromise.then(function(){if(this._bIsBeingDestroyed){return;}if(!i){if(this._btnAdapt){var p=this._getAssignedFilterNames();this.setProperty("_filterCount",this._oRb.getText(p.length?"filterbar.ADAPT_NONZERO":"filterbar.ADAPT",p.length),false);}}var t=this._getAssignedFiltersText();var O={conditionsBased:!i,filtersText:t.filtersText,filtersTextExpanded:t.filtersTextExpanded};this.fireFiltersChanged(O);}.bind(this));};o.prototype.onReset=function(i){this._getConditionModel().oConditionModel.removeAllConditions();};o.prototype.onSearch=function(i){this.triggerSearch();};o.prototype.triggerSearch=function(){if(this.getSuspendSelection()){this._bSearchTriggered=true;return;}this.waitForInitialization().then(function(){if(!this._oSearchPromise){this._oSearchPromise=new Promise(function(r){this._fResolvedSearchPromise=r;}.bind(this));var i=function(){this._search();this._fResolvedSearchPromise();this._oSearchPromise=null;};setTimeout(i.bind(this),0);}return this._oSearchPromise;}.bind(this));};o.prototype._clearDelayedSearch=function(){if(this._iDelayedSearchId){clearTimeout(this._iDelayedSearchId);this._iDelayedSearchId=null;}};o.prototype._getRequiredFieldsWithoutValues=function(){var r=[];this._getRequiredPropertyNames().forEach(function(N){var i=this._getConditionModel().getConditions(N);if(!i||i.length===0){r.push(N);}}.bind(this));return r;};o.prototype._checkAsyncValidation=function(){var r=E.NoError;if(this._aFIChanges&&this._aFIChanges.length>0){r=E.AsyncValidation;}return r;};o.prototype._checkRequiredFields=function(){var r=E.NoError;var R=this._getRequiredFieldsWithoutValues();R.forEach(function(N){var i=this._getFilterField(N);if(i){if(i.getValueState()===V.None){i.setValueState(V.Error);i.setValueStateText(this._oRb.getText("filterbar.REQUIRED_FILTER_VALUE_MISSING"));}}else{L.error("Mandatory filter field '"+N+"' not visible on FilterBarBase has no value.");}r=E.RequiredHasNoValue;}.bind(this));return r;};o.prototype._checkFieldsInErrorState=function(){var r=E.NoError;this._getNonRequiredPropertyNames().some(function(N){var i=this._getFilterField(N);if(i&&(i.getValueState()!==V.None)){r=E.FieldInErrorState;}return r!==E.NoError;}.bind(this));return r;};o.prototype._handleFilterItemChanges=function(i){if(this._bIgnoreChanges){return;}var p=i.oSource;if(p.getRequired()&&(p.getValueState()===V.Error)&&i.getParameter("valid")){p.setValueState(V.None);return;}if(!this._aFIChanges){this._aFIChanges=[];}this._aFIChanges.push({name:p.getFieldPath(),promise:i.getParameter("promise")});};o.prototype._checkFilters=function(){var r=this._checkAsyncValidation();if(r!==E.NoError){return r;}r=this._checkRequiredFields();if(r!==E.NoError){return r;}r=this._checkFieldsInErrorState();if(r!==E.NoError){return r;}return r;};o.prototype._setFocusOnFirstErroneousField=function(){this.getFilterItems().some(function(i){if(i.getValueState()!==V.None){setTimeout(i["focus"].bind(i),0);return true;}return false;});};o.prototype._handleAsyncValidation=function(){if(this._aFIChanges&&(this._aFIChanges.length>0)){var N=this._aFIChanges.slice();this._aFIChanges=null;var i=[];N.forEach(function(p){i.push(p.promise);});Promise.all(i).then(function(p){p.forEach(function(q,r){var s=this._getFilterField(N[r].name);if(s&&s.getRequired()&&(s.getValueState()===V.Error)){s.setValueState(V.None);}},this);this._search();}.bind(this),function(p){this._search();}.bind(this));}};o.prototype._search=function(){var s,r;r=this._checkFilters();if(r===E.AsyncValidation){this._handleAsyncValidation();return;}if(r===E.NoError){this.fireSearch();}else{if(r===E.RequiredHasNoValue){s=this._oRb.getText("filterbar.REQUIRED_CONDITION_MISSING");}else{s=this._oRb.getText("filterbar.VALIDATION_ERROR");}if(this.getShowMessages()&&!this._isLiveMode()){try{g.error(s,{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":"",onClose:this._setFocusOnFirstErroneousField.bind(this)});}catch(x){L.error(x.message);}}else{L.warning("search was not triggered. "+s);}}};o.prototype.setInternalConditions=function(i){var p=this._getConditionModel();if(p){p.setConditions(i);}};o.prototype.getInternalConditions=function(){return this._getModelConditions(this._getConditionModel(),true);};o.prototype.hasProperty=function(N){return this._getPropertyByName(N);};o.prototype.waitForInitialization=function(){return Promise.all([this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]);};o.prototype.initialized=function(){return this.waitForInitialization();};o.prototype._getModelConditions=function(i,p){var q={};if(i){var r=i.getAllConditions();for(var s in r){if(r[s]&&(r[s].length>0)){q[s]=m([],r[s]);if(!p&&this.bPersistValues){this._cleanupConditions(q[s]);var t=this._stringifyConditions(s,q[s]);q[s]=t;}}}}return q;};o.prototype.removeCondition=function(s,x){return this.waitForInitialization().then(function(){var i=this._getConditionModel();if(i){var p=this._getPropertyByName(s);if(p){var q=this._toInternal(p,x);if(i.indexOf(s,q)>=0){i.removeCondition(s,q);}}}}.bind(this));};o.prototype.addCondition=function(s,x){return this.waitForInitialization().then(function(){var i=this._getConditionModel();if(i){var p=this._getPropertyByName(s);if(p){var q=this._toInternal(p,x);if(i.indexOf(s,q)<0){var r=[{sFieldPath:p}];S.checkConditionOperatorSanity(r);if(r&&r.length>0){this._cleanUpFilterFieldInErrorStateByName(s);i.addCondition(s,q);}}}}}.bind(this));};o.prototype._setXConditions=function(i,r){var p,q,s=this._getConditionModel();if(r){s.removeAllConditions();}if(i){for(var t in i){q=i[t];p=this._getPropertyByName(t);if(p){if(q.length===0){s.removeAllConditions(t);}else{q.forEach(function(u){if(p.maxConditions!==-1){s.removeAllConditions(t);}var N=this._toInternal(p,u);s.addCondition(t,N);}.bind(this));}}}}};o.prototype._storeChanges=function(i){if(i&&i.length){var H=j.hasVariantManagement({element:this});try{h.add({changes:i,ignoreVariantManagement:!H});}catch(p){L.error("error while saving changes - "+p.message);}}};o.prototype._getRequiredPropertyNames=function(){var r=[];this._getNonHiddenPropertyInfoSet().forEach(function(p){if(p.required){r.push(I.getPropertyKey(p));}});return r;};o.prototype._getNonRequiredPropertyNames=function(){var N=[];this._getNonHiddenPropertyInfoSet().forEach(function(p){if(!p.required){N.push(I.getPropertyKey(p));}});return N;};o.prototype._insertFilterFieldtoContent=function(i,p){if(!this._cLayoutItem){return;}var q=this._cLayoutItem;var r=new q();r.setFilterField(i);this._oFilterBarLayout.insertFilterField(r,p);};o.prototype._filterItemInserted=function(i){if(!i.getVisible()){return;}if(i.setWidth){i.setWidth("");}this._applyFilterItemInserted(i);this._handleAssignedFilterNames(true);};o.prototype._applyFilterItemInserted=function(p){var q,r;r=this.indexOfAggregation("filterItems",p);if(this.getAggregation("basicSearchField")){r++;}q=r;var s=this.getFilterItems();for(var i=0;i<q;i++){if(!s[i].getVisible()){r--;}}this._insertFilterFieldtoContent(p,r);if(!this._oObserver.isObserved(p,{properties:["visible"]})){this._oObserver.observe(p,{properties:["visible"]});}};o.prototype._filterItemRemoved=function(i){this._applyFilterItemRemoved(i.getFieldPath());this._handleAssignedFilterNames(true);};o.prototype._applyFilterItemRemoved=function(s){this._removeFilterFieldFromContentByName(s);};o.prototype._removeFilterFieldFromContent=function(i){this._removeFilterFieldFromContentByName(i.getFieldPath());};o.prototype._removeFilterFieldFromContentByName=function(s){var i=this._getFilterItemLayoutByName(s);if(i){this._oFilterBarLayout.removeFilterField(i);i.destroy();}};o.prototype._observeChanges=function(i){if(i.type==="aggregation"&&i.name==="filterItems"){switch(i.mutation){case"insert":i.child.attachChange(this._handleFilterItemChanges,this);this._filterItemInserted(i.child);break;case"remove":i.child.detachChange(this._handleFilterItemChanges,this);this._filterItemRemoved(i.child);break;default:L.error("operation "+i.mutation+" not yet implemented");}}else if(i.type==="property"){var p;if(i.object.isA&&i.object.isA("sap.ui.mdc.FilterField")){p=i.object;if(p){if(i.current){this._filterItemInserted(p);}else{this._filterItemRemoved(p);}this._oFilterBarLayout.rerender();}}}};o.prototype._getFilterItemLayout=function(i){return this._getFilterItemLayoutByName(i.getFieldPath());};o.prototype._getFilterItemLayoutByName=function(s){var i=null;this._oFilterBarLayout.getFilterFields().some(function(p){if(p._getFieldPath()===s){i=p;}return i!==null;});return i;};o.prototype._getFilterField=function(N){var i=null;this.getFilterItems().some(function(p){if(p&&p.getFieldPath&&(p.getFieldPath()===N)){i=p;}return i!==null;});return i;};o.prototype._retrieveMetadata=function(){if(this._oMetadataAppliedPromise){return this._oMetadataAppliedPromise;}this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=new Promise(function(r){this._fResolveMetadataApplied=r;}.bind(this));this.initControlDelegate().then(function(){if(!this._bIsBeingDestroyed){this._aProperties=[];if(this.bDelegateInitialized&&this.getControlDelegate().fetchProperties){try{this.getControlDelegate().fetchProperties(this).then(function(p){this._aProperties=p;this._fResolveMetadataApplied();}.bind(this),function(s){L.error(s);this._fResolveMetadataApplied();}.bind(this));}catch(i){L.error("Exception during fetchProperties occured: "+i.message);this._fResolveMetadataApplied();}}else{L.error("Provided delegate '"+this.getDelegate().path+"' not valid.");this._fResolveMetadataApplied();}}}.bind(this));return this._oMetadataAppliedPromise;};o.prototype.setBasicSearchField=function(B){var O=this.getAggregation("basicSearchField");if(O){this._removeFilterFieldFromContent(O);}this.setAggregation("basicSearchField",B);if(B){if(!this._oObserver.isObserved(B,{properties:["visible"]})){this._oObserver.observe(B,{properties:["visible"]});}this._insertFilterFieldtoContent(B,0);}return this;};o.prototype.getPropertyInfoSet=function(){return this._aProperties||[];};o.prototype._getNonHiddenPropertyInfoSet=function(){var v=[];this.getPropertyInfoSet().every(function(p){if(!p.hiddenFilter){if(I.getPropertyKey(p)!=="$search"){v.push(p);}}return true;});return v;};o.prototype._getNonHiddenPropertyByName=function(N){var p=null;this._getNonHiddenPropertyInfoSet().some(function(P){if(I.getPropertyKey(P)===N){p=P;}return p!=null;});return p;};o.prototype._getPropertyByName=function(N){return n.getPropertyByKey(this.getPropertyInfoSet(),N);};o.prototype._cleanUpFilterFieldInErrorStateByName=function(s){var i=null;var p=this.getFilterItems();p.some(function(q){if(q.getFieldPath()===s){i=q;}return i!=null;});if(i){this._cleanUpFilterFieldInErrorState(i);}};o.prototype._cleanUpAllFilterFieldsInErrorState=function(){var i=this.getFilterItems();i.forEach(function(p){this._cleanUpFilterFieldInErrorState(p);}.bind(this));};o.prototype._cleanUpFilterFieldInErrorState=function(i){if(i.getRequired()&&(i.getValueState()!==V.None)){i.setValueState(V.None);}};o.prototype.applyConditionsAfterChangesApplied=function(){if(this._isChangeApplying()){return;}this._bIgnoreChanges=true;this._oFlexPromise=this._getWaitForChangesPromise();Promise.all([this._oFlexPromise,this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]).then(function(v){this._oFlexPromise=null;this._changesApplied();}.bind(this));};o.prototype._getWaitForChangesPromise=function(){return j.waitForChanges({element:this});};o.prototype._suspendBinding=function(i){if(i){var B=i.getBinding("conditions");if(B){if(!this._aBindings){this._aBindings=[];}B.suspend();this._aBindings.push(i);}}};o.prototype._resumeBindings=function(){if(this._aBindings){this._aBindings.forEach(function(i){if(!i.bIsDestroyed){var B=i.getBinding("conditions");if(B){B.resume();}}});this._aBindings=null;}};o.prototype._isChangeApplying=function(){return!!this._oFlexPromise;};o.prototype._applyInitialFilterConditions=function(){this._bIgnoreChanges=true;this._applyFilterConditionsChanges();this._changesApplied();this._bInitialFiltersApplied=true;this._fResolveInitialFiltersApplied();};o.prototype._applyFilterConditionsChanges=function(){var i;var s=this.getProperty("filterConditions");if(Object.keys(s).length>0){i=m([],s);this._setXConditions(i,true,true);}};o.prototype.setVariantBackreference=function(v){if(!this._hasAssignedVariantManagement()){this.setAssociation("variantBackreference",v);l.attachVariantApplied({selector:this,vmControlId:this.getVariantBackreference(),callback:this._handleVariantSwitch.bind(this),callAfterInitialVariant:true});}else{L.error("the association 'variant' may only be assigned once and may not change afterwards.");}};o.prototype._handleVariantSwitch=function(v){this._cleanUpAllFilterFieldsInErrorState();this._bExecuteOnSelect=false;if(v.hasOwnProperty("executeOnSelect")&&v.executeOnSelect){this._bExecuteOnSelect=true;}if(!this._oFlexPromise&&this._bInitialFiltersApplied){this._changesApplied();}};o.prototype._hasAssignedVariantManagement=function(){var v=this.getVariantBackreference();if(v&&sap.ui.getCore().byId(v)&&sap.ui.getCore().byId(v).isA("sap.ui.fl.variants.VariantManagement")){return true;}return false;};o.prototype._changesApplied=function(){this._bIgnoreChanges=false;this._bIgnoreChanges=false;this._reportModelChange(this._bExecuteOnSelect);this._bExecuteOnSelect=undefined;};o.prototype._getView=function(){return I.getView(this);};o.prototype.getConditions=function(){var i=this.getCurrentState().filter;if(i["$search"]){delete i["$search"];}return i;};o.prototype.getSearch=function(){var s=this._getConditionModel()?this._getConditionModel().getConditions("$search"):[];return s[0]?s[0].values[0]:"";};o.prototype.exit=function(){if(this._hasAssignedVariantManagement()){l.detachVariantApplied({selector:this,vmControlId:this.getVariantBackreference()});}if(this.bDelegateInitialized&&this.getControlDelegate().cleanup){this.getControlDelegate().cleanup(this);}C.prototype.exit.apply(this,arguments);this._clearDelayedSearch();this._oFilterBarLayout=null;this._cLayoutItem=null;this._btnAdapt=undefined;this._btnSearch=undefined;this._oRb=null;if(this._oModel){this._oModel.destroy();this._oModel=null;}if(this._oAdaptationController){this._oAdaptationController.destroy();this._oAdaptationController=null;}if(this._oConditionModel){this._oConditionModel.detachPropertyChange(this._handleConditionModelPropertyChange,this);this._oConditionModel.destroy();this._oConditionModel=null;}this._oObserver.disconnect();this._oObserver=undefined;this.bPersistValues=null;this._oDelegate=null;this._aProperties=null;this._oFlexPromise=null;this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=null;this._fResolveInitialFiltersApplied=undefined;this._oInitialFiltersAppliedPromise=null;this._fResolveSearchPromis=undefined;this._oSearchPromise=null;this._aBindings=null;};return o;});
