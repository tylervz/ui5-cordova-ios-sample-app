/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ValueListType","./lib/_Helper","sap/base/assert","sap/base/Log","sap/base/util/JSTokenizer","sap/base/util/ObjectPath","sap/ui/base/SyncPromise","sap/ui/model/BindingMode","sap/ui/model/ChangeReason","sap/ui/model/ClientListBinding","sap/ui/model/Context","sap/ui/model/ContextBinding","sap/ui/model/MetaModel","sap/ui/model/PropertyBinding","sap/ui/model/odata/OperationMode","sap/ui/model/odata/type/Boolean","sap/ui/model/odata/type/Byte","sap/ui/model/odata/type/Date","sap/ui/model/odata/type/DateTimeOffset","sap/ui/model/odata/type/Decimal","sap/ui/model/odata/type/Double","sap/ui/model/odata/type/Guid","sap/ui/model/odata/type/Int16","sap/ui/model/odata/type/Int32","sap/ui/model/odata/type/Int64","sap/ui/model/odata/type/Raw","sap/ui/model/odata/type/SByte","sap/ui/model/odata/type/Single","sap/ui/model/odata/type/Stream","sap/ui/model/odata/type/String","sap/ui/model/odata/type/TimeOfDay","sap/ui/thirdparty/URI"],function(V,_,a,L,J,O,S,B,C,b,c,d,M,P,f,g,h,E,D,k,l,G,I,m,o,R,p,q,r,s,T,U){"use strict";var t,u=new Map(),v=L.Level.DEBUG,w=/\$\(/g,x=/^-?\d+$/,y,z,A="sap.ui.model.odata.v4.ODataMetaModel",F,H=/\(.*\)$/,K=new R(),N=/\$\)/g,Q=new Map(),W={messageChange:true},X={"Edm.Boolean":{Type:g},"Edm.Byte":{Type:h},"Edm.Date":{Type:E},"Edm.DateTimeOffset":{constraints:{"$Precision":"precision"},Type:D},"Edm.Decimal":{constraints:{"@Org.OData.Validation.V1.Minimum/$Decimal":"minimum","@Org.OData.Validation.V1.Minimum@Org.OData.Validation.V1.Exclusive":"minimumExclusive","@Org.OData.Validation.V1.Maximum/$Decimal":"maximum","@Org.OData.Validation.V1.Maximum@Org.OData.Validation.V1.Exclusive":"maximumExclusive","$Precision":"precision","$Scale":"scale"},Type:k},"Edm.Double":{Type:l},"Edm.Guid":{Type:G},"Edm.Int16":{Type:I},"Edm.Int32":{Type:m},"Edm.Int64":{Type:o},"Edm.SByte":{Type:p},"Edm.Single":{Type:q},"Edm.Stream":{Type:r},"Edm.String":{constraints:{"@com.sap.vocabularies.Common.v1.IsDigitSequence":"isDigitSequence","$MaxLength":"maxLength"},Type:s},"Edm.TimeOfDay":{constraints:{"$Precision":"precision"},Type:T}},Y={},Z="@com.sap.vocabularies.Common.v1.ValueList",$="@com.sap.vocabularies.Common.v1.ValueListMapping",a1="@com.sap.vocabularies.Common.v1.ValueListReferences",b1="@com.sap.vocabularies.Common.v1.ValueListWithFixedValues",c1=L.Level.WARNING;function d1(e,i,j,n){var m1,n1=e.mSchema2MetadataUrl[i];if(!n1){n1=e.mSchema2MetadataUrl[i]={};n1[j]=false;}else if(!(j in n1)){m1=Object.keys(n1)[0];if(n1[m1]){j1(e,"A schema cannot span more than one document: "+i+" - expected reference URI "+m1+" but instead saw "+j,n);}n1[j]=false;}}function e1(e,i,j,n){var m1,n1,o1,p1;function q1(r1){var s1,t1;if(!(j in r1)){n(c1,n1," does not contain ",j);return;}n(v,"Including ",j," from ",n1);for(t1 in r1){if(t1[0]!=="$"&&k1(t1)===j){s1=r1[t1];i[t1]=s1;i1(s1,i.$Annotations);}}}if(j in i){return i[j];}p1=e.mSchema2MetadataUrl[j];if(p1){o1=Object.keys(p1);if(o1.length>1){j1(e,"A schema cannot span more than one document: "+"schema is referenced by following URLs: "+o1.join(", "),j);}n1=o1[0];p1[n1]=true;n(v,"Namespace ",j," found in $Include of ",n1);m1=e.mMetadataUrl2Promise[n1];if(!m1){n(v,"Reading ",n1);m1=e.mMetadataUrl2Promise[n1]=S.resolve(e.oRequestor.read(n1)).then(e.validate.bind(e,n1));}m1=m1.then(q1);if(j in i){return i[j];}i[j]=m1;return m1;}}function f1(e,i){if(e===i){return"";}if(e.startsWith(i)&&e[i.length]==="#"&&e.indexOf("@",i.length)<0){return e.slice(i.length+1);}}function g1(e){var i=f1(e,$);return i!==undefined?i:f1(e,Z);}function h1(n,e){return e.some(function(i){return n==="$ReturnType"?i.$ReturnType:i.$Parameter&&i.$Parameter.some(function(j){return j.$Name===n;});});}function i1(e,i,j){var n;function m1(n1,o1){var p1;for(p1 in o1){if(j||!(p1 in n1)){n1[p1]=o1[p1];}}}for(n in e.$Annotations){if(!(n in i)){i[n]={};}m1(i[n],e.$Annotations[n]);}delete e.$Annotations;}function j1(e,i,j){var n=new Error(j+": "+i);e.oModel.reportError(i,A,n);throw n;}function k1(e){return e.slice(0,e.lastIndexOf(".")+1);}y=d.extend("sap.ui.model.odata.v4.ODataMetaContextBinding",{constructor:function(e,i,j){a(!j||j.getModel()===e,"oContext must belong to this model");d.call(this,e,i,j);},initialize:function(){var e=this.oModel.createBindingContext(this.sPath,this.oContext);this.bInitial=false;if(e!==this.oElementContext){this.oElementContext=e;this._fireChange();}},setContext:function(e){a(!e||e.getModel()===this.oModel,"oContext must belong to this model");if(e!==this.oContext){this.oContext=e;if(!this.bInitial){this.initialize();}}}});z=b.extend("sap.ui.model.odata.v4.ODataMetaListBinding",{constructor:function(){b.apply(this,arguments);},_fireFilter:function(){},_fireSort:function(){},checkUpdate:function(e){var i=this.oList.length;this.update();if(e||this.oList.length!==i){this._fireChange({reason:C.Change});}},fetchContexts:function(){var i,e=this.oModel.resolve(this.sPath,this.oContext),j=this;if(!e){return S.resolve([]);}i=e.endsWith("@");if(!i&&!e.endsWith("/")){e+="/";}return this.oModel.fetchObject(e).then(function(n){if(!n){return[];}if(i){e=e.slice(0,-1);}return Object.keys(n).filter(function(m1){return m1[0]!=="$"&&i!==(m1[0]!=="@");}).map(function(m1){return new c(j.oModel,e+m1);});});},getContexts:function(i,e){this.iCurrentStart=i||0;this.iCurrentLength=Math.min(e||Infinity,this.iLength-this.iCurrentStart,this.oModel.iSizeLimit);return this.getCurrentContexts();},getCurrentContexts:function(){var e=[],i,n=this.iCurrentStart+this.iCurrentLength;for(i=this.iCurrentStart;i<n;i+=1){e.push(this.oList[this.aIndices[i]]);}if(this.oList.dataRequested){e.dataRequested=true;}return e;},setContexts:function(e){this.oList=e;this.updateIndices();this.applyFilter();this.applySort();this.iLength=this._getLength();},update:function(){var e=[],i=this.fetchContexts(),j=this;if(i.isFulfilled()){e=i.getResult();}else{i.then(function(e){j.setContexts(e);j._fireChange({reason:C.Change});});e.dataRequested=true;}this.setContexts(e);}});F=P.extend("sap.ui.model.odata.v4.ODataMetaPropertyBinding",{constructor:function(){P.apply(this,arguments);this.vValue=undefined;},checkUpdate:function(e,i){var j,n=this;function m1(n1){if(e||n1!==n.vValue){n.vValue=n1;n._fireChange({reason:i||C.Change});}return n1;}j=this.oModel.fetchObject(this.sPath,this.oContext,this.mParameters).then(m1);if(this.mParameters&&this.mParameters.$$valueAsPromise&&j.isPending()){m1(j.unwrap());}else if(j.isRejected()){j.unwrap();}},getValue:function(){return this.vValue;},setContext:function(e){if(this.oContext!==e){this.oContext=e;if(this.bRelative){this.checkUpdate(false,C.Context);}}},setValue:function(){throw new Error("Unsupported operation: ODataMetaPropertyBinding#setValue");}});var l1=M.extend("sap.ui.model.odata.v4.ODataMetaModel",{constructor:function(e,i,j,n,m1){M.call(this);this.aAnnotationUris=j&&!Array.isArray(j)?[j]:j;this.sDefaultBindingMode=B.OneTime;this.mETags={};this.dLastModified=new Date(0);this.oMetadataPromise=null;this.oModel=n;this.mMetadataUrl2Promise={};this.oRequestor=e;this.mSchema2MetadataUrl={};this.mSupportedBindingModes={"OneTime":true,"OneWay":true};this.bSupportReferences=m1!==false;this.mUnsupportedFilterOperators={"All":true,"Any":true};this.sUrl=i;}});l1.prototype.$$valueAsPromise=true;l1.prototype._mergeAnnotations=function(e,j){var n=this;this.validate(this.sUrl,e);e.$Annotations={};Object.keys(e).forEach(function(i){if(e[i].$kind==="Schema"){d1(n,i,n.sUrl);i1(e[i],e.$Annotations);}});j.forEach(function(m1,i){var n1,o1;n.validate(n.aAnnotationUris[i],m1);for(o1 in m1){if(o1[0]!=="$"){if(o1 in e){j1(n,"A schema cannot span more than one document: "+o1,n.aAnnotationUris[i]);}n1=m1[o1];e[o1]=n1;if(n1.$kind==="Schema"){d1(n,o1,n.aAnnotationUris[i]);i1(n1,e.$Annotations,true);}}}});};l1.prototype.attachEvent=function(e){if(!(e in W)){throw new Error("Unsupported event '"+e+"': v4.ODataMetaModel#attachEvent");}return M.prototype.attachEvent.apply(this,arguments);};l1.prototype.bindContext=function(e,i){return new y(this,e,i);};l1.prototype.bindList=function(e,i,j,n){return new z(this,e,i,j,n);};l1.prototype.bindProperty=function(e,i,j){return new F(this,e,i,j);};l1.prototype.bindTree=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#bindTree");};l1.prototype.fetchCanonicalPath=function(e){return this.fetchUpdateData("",e).then(function(i){if(!i.editUrl){throw new Error(e.getPath()+": No canonical path for transient entity");}if(i.propertyPath){throw new Error("Context "+e.getPath()+" does not point to an entity. It should be "+i.entityPath);}return"/"+i.editUrl;});};l1.prototype.fetchData=function(){return this.fetchEntityContainer().then(function(e){return JSON.parse(JSON.stringify(e));});};l1.prototype.fetchEntityContainer=function(e){var i,j=this;if(!this.oMetadataPromise){i=[S.resolve(this.oRequestor.read(this.sUrl,false,e))];if(this.aAnnotationUris){this.aAnnotationUris.forEach(function(n){i.push(S.resolve(j.oRequestor.read(n,true,e)));});}if(!e){this.oMetadataPromise=S.all(i).then(function(n){var m1=n[0];j._mergeAnnotations(m1,n.slice(1));return m1;});}}return this.oMetadataPromise;};l1.prototype.fetchObject=function(j,n,m1){var n1=this.resolve(j,n),o1=this;if(!n1){L.error("Invalid relative path w/o context",j,A);return S.resolve(null);}return this.fetchEntityContainer().then(function(p1){var q1,r1,s1,t1,u1,v1,w1,x1,y1;function z1(e,i,H1){var I1,J1,K1,L1,M1="";if(i){J1=i.indexOf("@@");if(J1>0){i=i.slice(0,J1);}}else{i=e;}H1=H1||"";if(q1){v1=L1=y1.filter(C1);if(L1.length!==1){return D1(c1,"Expected a single overload, but found "+L1.length);}if(q1!==Y){M1=L1[0].$Parameter[0].$isCollection?"Collection("+q1+")":q1;}K1=x1+"("+M1+")"+H1;if(p1.$Annotations[K1]){if(i==="@"){y1=p1.$Annotations[K1];I1=p1.$Annotations[x1+H1];if(I1){y1=Object.assign({},I1,y1);}return false;}if(i in p1.$Annotations[K1]){x1=K1;y1=p1;return true;}}}x1+=H1;y1=p1;return true;}function A1(i,j){var H1,I1,J1,K1=i.indexOf("@",2);if(K1>-1){return D1(c1,"Unsupported path after ",i.slice(0,K1));}i=i.slice(2);J1=i.indexOf("(");if(J1>0){if(!i.endsWith(")")){return D1(c1,"Expected ')' instead of '",i.slice(-1),"'");}try{I1=J.parseJS("["+i.slice(J1+1,-1).replace(w,"{").replace(N,"}")+"]");}catch(e){return D1(c1,e.message,": ",e.text.slice(1,e.at),"<--",e.text.slice(e.at,-1));}i=i.slice(0,J1);}H1=i[0]==="."?O.get(i.slice(1),m1.scope):m1&&O.get(i,m1.scope)||(i==="requestCurrencyCodes"||i==="requestUnitsOfMeasure"?o1[i].bind(o1):O.get(i));if(typeof H1!=="function"){return D1(c1,i," is not a function but: "+H1);}try{y1=H1(y1,{$$valueAsPromise:m1&&m1.$$valueAsPromise,arguments:I1,context:new c(o1,j),schemaChildName:w1,overload:v1.length===1?v1[0]:undefined});}catch(e){D1(c1,"Error calling ",i,": ",e);}return true;}function B1(e,i){var H1;if(e==="$ReturnType"){if(i.$ReturnType){y1=i.$ReturnType;return true;}}else if(e&&i.$Parameter){H1=i.$Parameter.filter(function(I1){return I1.$Name===e;});if(H1.length){y1=H1[0];return true;}}return false;}function C1(e){return!e.$IsBound&&q1===Y||e.$IsBound&&q1===e.$Parameter[0].$Type;}function D1(i){var e;if(L.isLoggable(i,A)){e=Array.isArray(s1)?s1.join("/"):s1;L[i===v?"debug":"warning"](Array.prototype.slice.call(arguments,1).join("")+(e?" at /"+e:""),n1,A);}if(i===c1){y1=undefined;}return false;}function E1(e,i){var H1;function I1(){s1=s1||x1&&i&&x1+"/"+i;return D1.apply(this,arguments);}q1=y1&&y1.$Type||q1;if(o1.bSupportReferences&&!(e in p1)){H1=k1(e);y1=e1(o1,p1,H1,I1);}if(e in p1){x1=t1=w1=e;y1=v1=p1[w1];if(!S.isThenable(y1)){return true;}}if(S.isThenable(y1)&&y1.isPending()){return I1(v,"Waiting for ",H1);}return I1(c1,"Unknown qualified name ",e);}function F1(e,i,H1){var I1,J1;if(e==="$Annotations"){return D1(c1,"Invalid segment: $Annotations");}if(i&&typeof y1==="object"&&e in y1){if(e[0]==="$"||x.test(e)){u1=false;}}else{I1=e.indexOf("@@");if(I1<0){if(e.endsWith("@sapui.name")){I1=e.length-11;}else{I1=e.indexOf("@");}}if(I1>0){if(!F1(e.slice(0,I1),i,H1)){return false;}e=e.slice(I1);J1=true;}if(typeof y1==="string"&&!(J1&&(e==="@sapui.name"||e[1]==="@"))&&!G1(y1,H1.slice(0,i))){return false;}if(u1){if(e[0]==="$"&&e!=="$Parameter"&&e!=="$ReturnType"||x.test(e)){u1=false;}else{if(J1){}else if(e[0]!=="@"&&e.indexOf(".")>0){return E1(e);}else if(y1&&"$Type"in y1){if(!E1(y1.$Type,"$Type")){return false;}}else if(y1&&"$Action"in y1){if(!E1(y1.$Action,"$Action")){return false;}q1=Y;}else if(y1&&"$Function"in y1){if(!E1(y1.$Function,"$Function")){return false;}q1=Y;}else if(!i){x1=t1=w1=w1||p1.$EntityContainer;y1=v1=v1||p1[w1];if(Array.isArray(y1)&&B1(e,y1[0])){return true;}if(e&&e[0]!=="@"&&!(e in v1)){return D1(c1,"Unknown child ",e," of ",w1);}}if(Array.isArray(y1)){if(e==="$Parameter"){return true;}if(e.startsWith("@$ui5.overload@")){e=e.slice(14);J1=true;}if(J1){if(e[1]!=="@"&&!z1(e)){return false;}}else{if(e!==H1[i]&&H1[i][e.length+1]!=="@"&&h1(e,y1)){t1=e;return z1(e,H1[i].slice(e.length),"/"+t1);}if(q1){y1=y1.filter(C1);}if(e==="@$ui5.overload"){return true;}if(y1.length!==1){return D1(c1,"Expected a single overload, but found "+y1.length);}if(B1(e,y1[0])){return true;}y1=y1[0].$ReturnType;x1+="/0/$ReturnType";if(y1){if(e==="value"&&!(p1[y1.$Type]&&p1[y1.$Type].value)){t1=undefined;return true;}if(!E1(y1.$Type,"$Type")){return false;}}if(!e){return true;}}}}}if(!e){return i+1>=H1.length||D1(c1,"Invalid empty segment");}if(e[0]==="@"){if(e==="@sapui.name"){y1=t1;if(y1===undefined){D1(c1,"Unsupported path before @sapui.name");}else if(i+1<H1.length){D1(c1,"Unsupported path after @sapui.name");}return false;}if(e[1]==="@"){if(i+1<H1.length){return D1(c1,"Unsupported path after ",e);}return A1(e,[""].concat(H1.slice(0,i),H1[i].slice(0,I1)).join("/"));}}if(!y1||typeof y1!=="object"){y1=undefined;return!r1&&D1(v,"Invalid segment: ",e);}if(u1&&e[0]==="@"){q1=y1.$Type||q1;y1=p1.$Annotations[x1]||{};u1=false;}else if(e==="$"&&i+1<H1.length){return D1(c1,"Unsupported path after $");}}if(e!=="@"&&e!=="$"){if(e[0]==="@"){r1=true;}t1=u1||e[0]==="@"?e:undefined;x1=u1?x1+"/"+e:undefined;y1=y1[e];}return true;}function G1(e,i){var H1;if(s1){return D1(c1,"Invalid recursion");}s1=i;r1=false;u1=true;y1=p1;H1=e.split("/").every(F1);s1=undefined;return H1;}if(!G1(n1.slice(1))&&S.isThenable(y1)){y1=y1.then(function(){return o1.fetchObject(j,n,m1);});}return y1;});};l1.prototype.fetchUI5Type=function(e){var i=this.getMetaContext(e),j=this;if(e.endsWith("/$count")){t=t||new o();return S.resolve(t);}return this.fetchObject(undefined,i).catch(function(){}).then(function(n){var m1=K,n1;if(!n){L.warning("No metadata for path '"+e+"', using "+m1.getName(),undefined,A);return m1;}if(n["$ui5.type"]){return n["$ui5.type"];}if(n.$isCollection){L.warning("Unsupported collection type, using "+m1.getName(),e,A);}else{n1=X[n.$Type];if(n1){m1=new n1.Type(undefined,j.getConstraints(n,i.getPath()));}else{L.warning("Unsupported type '"+n.$Type+"', using "+m1.getName(),e,A);}}n["$ui5.type"]=m1;return m1;});};l1.prototype.fetchUpdateData=function(e,j,n){var m1=j.getModel(),n1=m1.resolve(e,j),o1=this;function p1(i){var q1=new Error(n1+": "+i);m1.reportError(i,A,q1);throw q1;}return this.fetchObject(this.getMetaPath(n1)).then(function(){return o1.fetchEntityContainer();}).then(function(q1){var r1,s1=q1[q1.$EntityContainer],t1,u1,v1,w1,x1,y1,z1,A1;function B1(F1){var i=F1.indexOf("(");return i>=0?F1.slice(i):"";}function C1(i){r1.push({path:x1,prefix:i,type:A1});}function D1(F1){var i=F1.indexOf("(");return i>=0?F1.slice(0,i):F1;}function E1(i){if(i.includes("($uid=")){C1(D1(i));}else{r1.push(i);}}z1=n1.slice(1).split("/");w1=z1.shift();x1="/"+w1;t1=x1;v1=decodeURIComponent(D1(w1));u1=s1[v1];if(!u1){p1("Not an entity set: "+v1);}A1=q1[u1.$Type];e="";y1="";r1=[];E1(w1);z1.forEach(function(i){var F1,G1;x1+="/"+i;if(x.test(i)){C1(r1.pop());t1+="/"+i;}else{G1=decodeURIComponent(D1(i));y1=_.buildPath(y1,G1);F1=A1[G1];if(!F1){p1("Not a (navigation) property: "+G1);}A1=q1[F1.$Type];if(F1.$kind==="NavigationProperty"){if(u1.$NavigationPropertyBinding&&y1 in u1.$NavigationPropertyBinding){v1=u1.$NavigationPropertyBinding[y1];u1=s1[v1];y1="";r1=[encodeURIComponent(v1)+B1(i)];if(!F1.$isCollection){C1(r1.pop());}}else{E1(i);}t1=x1;e="";}else{e=_.buildPath(e,i);}}});if(n){return S.resolve({editUrl:undefined,entityPath:t1,propertyPath:e});}return S.all(r1.map(function(i){if(typeof i==="string"){return i;}return j.fetchValue(i.path).then(function(F1){var G1;if(!F1){p1("No instance to calculate key predicate at "+i.path);}if(_.hasPrivateAnnotation(F1,"transient")){n=true;return undefined;}G1=_.getPrivateAnnotation(F1,"predicate");if(!G1){p1("No key predicate known at "+i.path);}return i.prefix+G1;},function(F1){p1(F1.message+" at "+i.path);});})).then(function(i){return{editUrl:n?undefined:i.join("/"),entityPath:t1,propertyPath:e};});});};l1.prototype.fetchValueListMappings=function(e,i,j,n){var m1=this,n1=e.getMetaModel();function o1(){var p1=n[0],q1="";if(n.length!==1){throw new Error("Expected a single overload, but found "+n.length);}if(p1.$IsBound){q1=p1.$Parameter[0].$isCollection?"Collection("+p1.$Parameter[0].$Type+")":p1.$Parameter[0].$Type;}return i+"("+q1+")";}return n1.fetchEntityContainer().then(function(p1){var q1,r1=p1.$Annotations,s1,t1=_.namespace(i),u1={},v1=m1===n1,w1,x1;if(j.$Name){s1=o1()+"/"+j.$Name;x1=i+"/"+j.$Name;}w1=Object.keys(r1).filter(function(y1){if(_.namespace(y1)===t1){if(s1?y1===s1||y1===x1:m1.getObject("/"+y1)===j){return true;}if(v1||x1&&_.getMetaPath(y1)===x1){return false;}throw new Error("Unexpected annotation target '"+y1+"' with namespace of data service in "+e.sServiceUrl);}return false;});if(!w1.length){throw new Error("No annotation '"+Z.slice(1)+"' in "+e.sServiceUrl);}if(w1.length===1){q1=r1[w1[0]];}else{q1=Object.assign({},r1[x1],r1[s1]);}Object.keys(q1).forEach(function(y1){var z1=g1(y1);if(z1!==undefined){u1[z1]=q1[y1];["CollectionRoot","SearchSupported"].forEach(function(A1){if(A1 in q1[y1]){throw new Error("Property '"+A1+"' is not allowed in annotation '"+y1.slice(1)+"' for target '"+w1[0]+"' in "+e.sServiceUrl);}});}else if(!v1){throw new Error("Unexpected annotation '"+y1.slice(1)+"' for target '"+w1[0]+"' with namespace of data service in "+e.sServiceUrl);}});return u1;});};l1.prototype.fetchValueListType=function(e){var i=this.getMetaContext(e),j=this;return this.fetchObject(undefined,i).then(function(n){var m1,n1;if(!n){throw new Error("No metadata for "+e);}m1=j.getObject("@",i);if(m1[b1]){return V.Fixed;}for(n1 in m1){if(f1(n1,a1)!==undefined||f1(n1,$)!==undefined){return V.Standard;}if(f1(n1,Z)!==undefined){return m1[n1].SearchSupported===false?V.Fixed:V.Standard;}}return V.None;});};l1.prototype.getAbsoluteServiceUrl=function(e){var i=new U(this.sUrl).absoluteTo(document.baseURI).pathname().toString();return new U(e).absoluteTo(i).filename("").toString();};l1.prototype.getAllPathReductions=function(e,n,m1,n1){var o1=n.split("/").length,p1,q1={},r1=e.split("/"),s1=this;function t1(j,u1,v1,w1){var i,x1,y1;function z1(A1){if(!m1){t1(j,u1,i-1,true);}if(w1){u1=u1.slice();j=j.slice();}u1.splice(i,A1);j.splice(i,A1);if(!m1){q1[j.join("/")]=true;}}for(i=v1;i>=o1;i-=1){x1=x.test(j[i+1])?i+2:i+1;if(x1<j.length&&u1[i].$Partner===j[x1]&&!u1[x1].$isCollection&&u1[x1].$Partner===j[i].replace(H,"")){z1(x1-i+1);}else if(Array.isArray(u1[i])&&j[i+1]==="$Parameter"){y1=s1.getObject(s1.getMetaPath(j.slice(0,i+1).join("/")+"/@$ui5.overload"));if(y1.length===1&&y1[0].$Parameter[0].$Name===j[i+2]){z1(3);}}else if(n1&&u1[i].$isCollection){break;}}}p1=r1.map(function(i,j){return j<o1||i[0]==="#"||i[0]==="@"||x.test(i)||i==="$Parameter"?{}:s1.getObject(s1.getMetaPath(r1.slice(0,j+1).join("/")))||{};});q1[e]=true;if(!(n1&&p1[r1.length-1].$isCollection)){t1(r1,p1,r1.length-2);}return m1?r1.join("/"):Object.keys(q1);};l1.prototype.getConstraints=function(e,i){var j,n,m1,n1=X[e.$Type];function o1(p1,q1){if(q1!==undefined){n=n||{};n[p1]=q1;}}if(n1){m1=n1.constraints;for(j in m1){o1(m1[j],j[0]==="@"?this.getObject(i+j):e[j]);}if(e.$Nullable===false){o1("nullable",false);}}return n;};l1.prototype.getData=_.createGetMethod("fetchData");l1.prototype.getETags=function(){return this.mETags;};l1.prototype.getLastModified=function(){return this.dLastModified;};l1.prototype.getMetaContext=function(e){return new c(this,this.getMetaPath(e));};l1.prototype.getMetaPath=function(e){return _.getMetaPath(e);};l1.prototype.getObject=_.createGetMethod("fetchObject");l1.prototype.getOrCreateSharedModel=function(e,i,j){var n,m1;e=this.getAbsoluteServiceUrl(e);n=!!j+e;m1=Q.get(n);if(!m1){m1=new this.oModel.constructor({autoExpandSelect:j,groupId:i,httpHeaders:this.oModel.getHttpHeaders(),operationMode:f.Server,serviceUrl:e,sharedRequests:true,synchronizationMode:"None"});Q.set(n,m1);}return m1;};l1.prototype.getOriginalProperty=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#getOriginalProperty");};l1.prototype.getProperty=l1.prototype.getObject;l1.prototype.getReducedPath=function(e,i){return this.getAllPathReductions(e,i,true,true);};l1.prototype.getUI5Type=_.createGetMethod("fetchUI5Type",true);l1.prototype.getUnitOrCurrencyPath=function(e){var i=this.getObject("@",this.getMetaContext(e)),j=i&&(i["@Org.OData.Measures.V1.Unit"]||i["@Org.OData.Measures.V1.ISOCurrency"]);return j&&j.$Path;};l1.prototype.getValueListType=_.createGetMethod("fetchValueListType",true);l1.prototype.isList=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#isList");};l1.prototype.refresh=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#refresh");};l1.prototype.requestCodeList=function(e,i,j){var n=this.fetchEntityContainer().getResult(),m1=n[n.$EntityContainer],n1=this;if(j&&j.context){if(j.context.getModel()!==this||j.context.getPath()!=="/"){throw new Error("Unsupported context: "+j.context);}}if(i!==undefined&&i!==m1){throw new Error("Unsupported raw value: "+i);}return this.requestObject("/@com.sap.vocabularies.CodeList.v1."+e).then(function(o1){var p1,q1,r1,s1,t1;if(!o1){return null;}p1=n1.getAbsoluteServiceUrl(o1.Url)+"#"+o1.CollectionPath;s1=u.get(p1);if(s1){return s1;}r1=n1.getOrCreateSharedModel(o1.Url,"$direct");q1=r1.getMetaModel();t1="/"+o1.CollectionPath+"/";s1=q1.requestObject(t1).then(function(u1){var v1=t1+"@Org.OData.Core.V1.AlternateKeys",w1=q1.getObject(v1),x1,y1=G1(u1.$Key),z1=t1+y1+"@com.sap.vocabularies.Common.v1.",A1,B1,C1=t1+y1+"@com.sap.vocabularies.CodeList.v1.StandardCode/$Path",D1,E1;function F1(H1,I1){var J1=I1.getProperty(y1),K1={Text:I1.getProperty(E1),UnitSpecificScale:I1.getProperty(B1)};if(D1){K1.StandardCode=I1.getProperty(D1);}if(K1.UnitSpecificScale===null){L.error("Ignoring customizing w/o unit-specific scale for code "+J1+" from "+o1.CollectionPath,o1.Url,A);}else{H1[J1]=K1;}return H1;}function G1(H1){var I1;if(H1&&H1.length===1){I1=H1[0];}else{throw new Error("Single key expected: "+t1);}return typeof I1==="string"?I1:I1[Object.keys(I1)[0]];}if(w1){if(w1.length!==1){throw new Error("Single alternative expected: "+v1);}else if(w1[0].Key.length!==1){throw new Error("Single key expected: "+v1+"/0/Key");}y1=w1[0].Key[0].Name.$PropertyPath;}B1=q1.getObject(z1+"UnitSpecificScale/$Path");E1=q1.getObject(z1+"Text/$Path");A1=[y1,B1,E1];D1=q1.getObject(C1);if(D1){A1.push(D1);}x1=r1.bindList("/"+o1.CollectionPath,null,null,null,{$select:A1});return x1.requestContexts(0,Infinity).then(function(H1){if(!H1.length){L.error("Customizing empty for ",r1.sServiceUrl+o1.CollectionPath,A);}return H1.reduce(F1,{});}).finally(function(){x1.destroy();});});u.set(p1,s1);return s1;});};l1.prototype.requestCurrencyCodes=function(e,i){return this.requestCodeList("CurrencyCodes",e,i);};l1.prototype.requestData=_.createRequestMethod("fetchData");l1.prototype.requestObject=_.createRequestMethod("fetchObject");l1.prototype.requestUI5Type=_.createRequestMethod("fetchUI5Type");l1.prototype.requestUnitsOfMeasure=function(e,i){return this.requestCodeList("UnitsOfMeasure",e,i);};l1.prototype.requestValueListInfo=function(e,i){var j=this.getMetaPath(e),n=j.slice(0,j.lastIndexOf("/")).replace("/$Parameter",""),m1=n.slice(n.lastIndexOf("/")+1),n1=this;if(!m1.includes(".")){m1=undefined;}return Promise.all([m1||this.requestObject(n+"/@sapui.name"),this.requestObject(j),this.requestObject(j+"@"),this.requestObject(j+b1),this.requestObject(n+"/@$ui5.overload")]).then(function(o1){var p1=o1[2],q1=o1[3],r1={},s1=o1[1],t1={};function u1(v1,w1,x1,y1){if(q1!==undefined&&"SearchSupported"in v1){throw new Error("Must not set 'SearchSupported' in annotation "+"'com.sap.vocabularies.Common.v1.ValueList' and annotation "+"'com.sap.vocabularies.Common.v1.ValueListWithFixedValues'");}if("CollectionRoot"in v1){y1=n1.getOrCreateSharedModel(v1.CollectionRoot,undefined,i);if(t1[w1]&&t1[w1].$model===y1){r1[w1]=undefined;}}if(r1[w1]){throw new Error("Annotations '"+Z.slice(1)+"' with identical qualifier '"+w1+"' for property "+e+" in "+r1[w1]+" and "+x1);}r1[w1]=x1;v1=_.clone(v1);v1.$model=y1;delete v1.CollectionRoot;delete v1.SearchSupported;t1[w1]=v1;}if(!s1){throw new Error("No metadata for "+e);}return Promise.all(Object.keys(p1).filter(function(v1){return f1(v1,a1)!==undefined;}).map(function(v1){var w1=p1[v1];return Promise.all(w1.map(function(x1){var y1=n1.getOrCreateSharedModel(x1,undefined,i);return n1.fetchValueListMappings(y1,o1[0],s1,o1[4]).then(function(z1){Object.keys(z1).forEach(function(A1){u1(z1[A1],A1,x1,y1);});});}));})).then(function(){var v1;Object.keys(p1).filter(function(w1){return g1(w1)!==undefined;}).forEach(function(w1){u1(p1[w1],g1(w1),n1.sUrl,n1.oModel);});v1=Object.keys(t1);if(!v1.length){throw new Error("No annotation '"+a1.slice(1)+"' for "+e);}if(q1){if(v1.length>1){throw new Error("Annotation '"+b1.slice(1)+"' but multiple '"+Z.slice(1)+"' for property "+e);}return{"":t1[v1[0]]};}return t1;});});};l1.prototype.requestValueListType=_.createRequestMethod("fetchValueListType");l1.prototype.resolve=function(e,i){var j,n;if(!e){return i?i.getPath():undefined;}n=e[0];if(n==="/"){return e;}if(!i){return undefined;}if(n==="."){if(e[1]!=="/"){throw new Error("Unsupported relative path: "+e);}e=e.slice(2);}j=i.getPath();return n==="@"||j.endsWith("/")?j+e:j+"/"+e;};l1.prototype.setLegacySyntax=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#setLegacySyntax");};l1.prototype.toString=function(){return A+": "+this.sUrl;};l1.prototype.validate=function(e,j){var i,n,m1,n1,o1,p1;if(!this.bSupportReferences){return j;}for(p1 in j.$Reference){o1=j.$Reference[p1];p1=new U(p1).absoluteTo(this.sUrl).toString();if("$IncludeAnnotations"in o1){j1(this,"Unsupported IncludeAnnotations",e);}for(i in o1.$Include){n1=o1.$Include[i];if(n1 in j){j1(this,"A schema cannot span more than one document: "+n1+" - is both included and defined",e);}d1(this,n1,p1,e);}}m1=j.$LastModified?new Date(j.$LastModified):null;this.mETags[e]=j.$ETag?j.$ETag:m1;n=j.$Date?new Date(j.$Date):new Date();m1=m1||n;if(this.dLastModified<m1){this.dLastModified=m1;}delete j.$Date;delete j.$ETag;delete j.$LastModified;return j;};return l1;});
