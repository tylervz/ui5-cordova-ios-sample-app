/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/LayerUtils","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/fl/write/api/VersionsAPI","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/base/util/UriParameters"],function(L,a,F,V,b,P){"use strict";function i(r){return b.isVersioningEnabled(r.layer).then(function(v){if(v){return V.isDraftAvailable({selector:r.selector,layer:r.layer});}});}function c(r){var u=r.layer===a.USER;if(!u){return P.hasHigherLayerChanges({selector:r.selector,ignoreMaxLayerParameter:r.ignoreMaxLayerParameter});}}var R={getReloadReasonsForStart:function(r){var u=R.hasMaxLayerParameterWithValue({value:r.layer});var U=R.hasVersionParameterWithValue({value:r.layer});return Promise.all([(!u)?c(r):false,(!U)?i(r):false]).then(function(d){r.hasHigherLayerChanges=!!d[0];r.hasDraftChanges=!!d[1];return r;});},hasVersionParameterWithValue:function(p){var s=L.FL_VERSION_PARAM;return F.hasParameterAndValue(s,p.value);},hasMaxLayerParameterWithValue:function(p){var s=L.FL_MAX_LAYER_PARAM;return F.hasParameterAndValue(s,p.value);},handleUrlParametersForStandalone:function(r){var u=F.getUshellContainer();if(!u){if(r.hasHigherLayerChanges){r.parameters=F.handleUrlParameters(r.parameters,L.FL_MAX_LAYER_PARAM,r.layer);}if(r.hasDraftChanges){r.parameters=F.handleUrlParameters(r.parameters,L.FL_VERSION_PARAM,r.layer);}}return r.parameters;},handleParametersOnStart:function(r){var p=F.getParsedURLHash();p.params=p.params||{};if(r.hasHigherLayerChanges){p.params[L.FL_MAX_LAYER_PARAM]=[r.layer];}if(r.hasDraftChanges){p.params[L.FL_VERSION_PARAM]=[r.layer];}return p;},initialDraftGotActivated:function(r){if(r.versioningEnabled){var u=this.hasVersionParameterWithValue({value:r.layer});var v=V.getVersions(r);return v&&v[0]&&v[0].versionNumber!==0&&u;}return false;},getReloadMethod:function(r){var o={NOT_NEEDED:"NO_RELOAD",RELOAD_PAGE:"HARD_RELOAD",VIA_HASH:"CROSS_APP_NAVIGATION"};r.reloadMethod=o.NOT_NEEDED;r.hasDraftChanges=r.hasDirtyDraftChanges||R.hasVersionParameterWithValue({value:r.layer});r.hasHigherLayerChanges=R.hasMaxLayerParameterWithValue({value:r.layer});r.initialDraftGotActivated=R.initialDraftGotActivated(r);if(r.changesNeedReload||r.hasDraftChanges||r.hasHigherLayerChanges||r.initialDraftGotActivated){r.reloadMethod=o.RELOAD_PAGE;if(!r.changesNeedReload&&F.getUshellContainer()){r.reloadMethod=o.VIA_HASH;}}return r;}};return R;});
