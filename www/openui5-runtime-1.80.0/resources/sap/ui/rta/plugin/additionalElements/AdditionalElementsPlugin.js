/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/rta/plugin/Plugin","sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/ui/rta/Utils","sap/ui/fl/Utils","sap/ui/dt/Util","sap/ui/core/StashedControlSupport","sap/ui/dt/ElementDesignTimeMetadata","sap/base/Log","sap/base/util/merge","sap/ui/fl/apply/api/DelegateMediatorAPI","sap/ui/core/util/reflection/JsControlTreeModifier"],function(P,E,O,U,F,D,S,a,L,m,b,J){"use strict";function _(s,i,r){var t;var R=i;if(r){var u=["addODataProperty","reveal","custom"].some(function(x){return r.isResponsibleElementActionAvailable(i,x);});if(u){R=r.getResponsibleElementOverlay(i);}}var v=R.getRelevantContainer(!s);var w=O.getOverlay(v);if(s){t=R.getParentElementOverlay();}else{t=R;}return{responsibleElementOverlay:R,relevantContainerOverlay:w,parentOverlay:t,relevantContainer:v,parent:t&&t.getElement()};}function c(i,C){return C.sParentAggregationName;}function d(i,s){var r=i.getElement();if(!r){return[];}var I=E.getAggregation(r,s).filter(function(C){var u=O.getOverlay(C);if(!this.hasStableId(u)){return false;}var R=i.getRelevantContainer(true);var v=O.getOverlay(R);var w=i;var x=false;do{x=!w.getElementVisibility();if(x){break;}if(w===v){break;}else{w=w.getParentElementOverlay();}}while(w);if(x){return true;}return u.getElementVisibility()===false;},this);var t=S.getStashedControls(r.getId());return I.concat(t);}function e(i){return(i["addViaDelegate"]&&i["addViaDelegate"].designTimeMetadata)||(i["addODataProperty"]&&i["addODataProperty"].designTimeMetadata)||(i["addViaCustom"]&&i["addViaCustom"].designTimeMetadata);}var f=true;var g=false;function h(r,i,s,t,C){var N=[];var u;var v;if(i.addODataProperty||i.addViaCustom||i.addViaDelegate){var w=i.aggregation;var x=e(i);u=x.getAggregationDescription(w,s);if(u){v=t?u.singular:u.plural;N.push(v);}}if(i.reveal){i.reveal.controlTypeNames.forEach(function(u){v=t?u.singular:u.plural;N.push(v);});}var y=N.reduce(function(z,B){if(z.indexOf(B)===-1){z.push(B);}return z;},[]);var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");if(y.length===1){v=y[0];}else if(C){v=C;}else{v=T.getText("MULTIPLE_CONTROL_NAME");}return T.getText(r,[v]);}function j(){return{designTimeMetadata:new a({data:{name:{singular:function(){return sap.ui.getCore().getLibraryResourceBundle("sap.uxap").getText("SECTION_CONTROL_NAME");},plural:function(){return sap.ui.getCore().getLibraryResourceBundle("sap.uxap").getText("SECTION_CONTROL_NAME_PLURAL");}},actions:{reveal:{changeType:"unstashControl",getAggregationName:c}}}}),action:{changeType:"unstashControl",getAggregationName:c}};}function k(i,r){var R;i.reveal.elements.some(function(s){if(s.element.getId()===r.getId()){R=s;return false;}});return R;}function l(i,r){var R=r.responsibleElementOverlay.getParentAggregationOverlay().getAggregationName();return i.aggregation===R;}function n(i,r,s,t){return i.reduce(function(u,v){return u.then(function(w){var C=v.changeOnRelevantContainer?r.relevantContainer:r.parent;var x=O.getOverlay(C);var V=v.changeType&&t.hasStableId(x);if(V){v.element=C;if(s){return b.getDelegateForControl({control:C,modifier:J,supportsDefault:v.supportsDefaultDelegate}).then(function(y){if(y&&y.name){v.delegateInfo=y;w.push(v);}return w;});}w.push(v);return w;}});},Promise.resolve([]));}function o(i,r){return this.hasChangeHandler(i.changeType,i.element).then(function(H){if(H){return{aggregationName:i.aggregation,addPropertyActionData:{designTimeMetadata:r,action:i}};}});}function p(i,r){return this.hasChangeHandler(i.changeType,i.element).then(function(H){if(H){return{aggregationName:i.aggregation,addPropertyActionData:{designTimeMetadata:r,action:i,delegateInfo:{payload:i.delegateInfo.payload||{},delegate:i.delegateInfo.instance,modelType:i.delegateInfo.modelType}}};}});}var A=P.extend("sap.ui.rta.plugin.additionalElements.AdditionalElementsPlugin",{metadata:{library:"sap.ui.rta",properties:{analyzer:"object",dialog:"object",commandFactory:"object"},associations:{},events:{}},getContextMenuTitle:function(i,r){var s=_(i,r,this);var t=this._getActionsOrUndef(i,r);return h("CTX_ADD_ELEMENTS",t,s.parent,f);},isAvailable:function(i,r){return r.every(function(s){return this._isEditableByPlugin(s,i);},this);},isEnabled:function(i,r){if(r.length>1){return false;}var s=this.getResponsibleElementOverlay(r[0]);var t;var I;if(i){t=s.getParentElementOverlay();if(t){I=true;}else{I=false;}}else{var u=this._getActionsOrUndef(i,s);if((!u.reveal||u.reveal.elements.length===0)&&!u.addViaCustom&&!u.addODataProperty&&!u.addViaDelegate){I=false;}else{I=true;}}var C=this.getCachedElements(i);var v=C&&C.length>0;I=I&&(v||this.getDialog().getCustomFieldEnabled());return I;},registerElementOverlay:function(i){var M=i.getElement().getModel();if(M){var r=M.getMetaModel();if(r&&r.loaded){r.loaded().then(function(){this.evaluateEditable([i],{onRegistration:true});}.bind(this));}}P.prototype.registerElementOverlay.apply(this,arguments);},_getRevealActions:function(s,i){var r=_(s,i,this);var t=[r.parentOverlay];if(r.relevantContainer!==r.parent){t=E.findAllSiblingsInContainer(r.parent,r.relevantContainer).map(function(w){return O.getOverlay(w);}).filter(function(w){return w;});}var u;if(s){var v=r.responsibleElementOverlay.getParentAggregationOverlay();u=v?[r.responsibleElementOverlay.getParentAggregationOverlay().getAggregationName()]:[];}else{u=r.parentOverlay.getAggregationOverlays().filter(function(w){return!w.getDesignTimeMetadata().isIgnored(r.parent);}).map(function(w){return w.getAggregationName();});}return u.reduce(function(w,x){return w.then(function(R){return this._getRevealActionFromAggregations(t,R,x);}.bind(this));}.bind(this),Promise.resolve({}));},_getRevealActionFromAggregations:function(i,r,s){var I=i.reduce(function(u,v){return v?u.concat(d.call(this,v,s)):u;}.bind(this),[]);var t={elements:[],controlTypeNames:[]};var R=I.reduce(function(u,v){return u.then(function(w){return this._invisibleToReveal(w,v);}.bind(this));}.bind(this),Promise.resolve(t));return R.then(function(u){if(u.elements.length>0){r[s]={reveal:u};}return r;});},_invisibleToReveal:function(r,i){return Promise.resolve().then(function(){var t=i.getMetadata().getName();var s;var R;var u=false;var H=Promise.resolve();if(t==="sap.ui.core._StashedControl"){var v=j();s=v.designTimeMetadata;R=v.action;u=true;}else{var w=O.getOverlay(i);if(w){s=w.getDesignTimeMetadata();R=s&&s.getAction("reveal",i);if(R&&R.changeType){var x=i;if(R.changeOnRelevantContainer){x=w.getRelevantContainer();}H=this.hasChangeHandler(R.changeType,x).then(function(y){if(y){if(R.changeOnRelevantContainer){var z=_(true,w);u=this.hasStableId(z.relevantContainerOverlay)&&this.hasStableId(z.parentOverlay);}else{u=true;}if(!R.getAggregationName){R.getAggregationName=c;}}}.bind(this));}}}return H.then(function(){if(u){r.elements.push({element:i,designTimeMetadata:s,action:R});var N=s.getName(i);if(N){r.controlTypeNames.push(N);}}return r;});}.bind(this));},_getAddPropertyActions:function(s,i){var r=_(s,i,this);var t=r.parentOverlay&&r.parentOverlay.getDesignTimeMetadata();var u="addViaDelegate";var G=p.bind(this);return Promise.resolve().then(function(){if(t){var v=t.getActionDataFromAggregations("add",r.parent,undefined,"delegate");return n(v,r,true,this);}return[];}.bind(this)).then(function(v){if(v.length===0&&t){u="addODataProperty";G=o.bind(this);v=t.getActionDataFromAggregations(u,r.parent);return n(v,r,false,this);}return v;}.bind(this)).then(function(v){return v.reduce(function(w,x){return w.then(function(R){return G(x,t).then(function(y){if(y){y.addPropertyActionData.relevantContainer=r.relevantContainer;if(!R[y.aggregationName]){R[y.aggregationName]={};}R[y.aggregationName][u]=y.addPropertyActionData;}return R;});});},Promise.resolve({}));});},_getCustomAddActions:function(s,i){var r=_(s,i,this);var t=r.parentOverlay&&r.parentOverlay.getDesignTimeMetadata();var u=t&&t.getActionDataFromAggregations("add",r.parent,undefined,"custom")||[];function v(w,C){var I=[];return Promise.resolve().then(function(){if(w&&typeof w.getItems==="function"){var x=O.getOverlay(C);if(this.hasStableId(x)){return w.getItems(C);}}}.bind(this)).then(function(x){I=x;if(Array.isArray(I)){var y=I.reduce(function(z,B){if(B.changeSpecificData.changeOnRelevantContainer){C=r.relevantContainer;}if(B.changeSpecificData.changeType){z.push(this.hasChangeHandler(B.changeSpecificData.changeType,C));}return z;}.bind(this),[]);return Promise.all(y);}}.bind(this)).then(function(H){if(Array.isArray(H)&&I.length===H.length&&H.indexOf(false)===-1){return{aggregationName:w.aggregation,addViaCustom:{designTimeMetadata:t,action:w,items:I}};}});}var C=r.parent;return u.reduce(function(w,x){return w.then(function(R){return v.call(this,x,C).then(function(y){if(y){R[y.aggregationName]={addViaCustom:y.addViaCustom};}return R;});}.bind(this));}.bind(this),Promise.resolve({}));},_getActions:function(s,i,I){return new Promise(function(r,t){var u=s?"asSibling":"asChild";if(!I&&i._mAddActions){return r(i._mAddActions[u]);}var R=this._getRevealActions(s,i);var v=this._getAddPropertyActions(s,i);var C=this._getCustomAddActions(s,i);return Promise.all([R,v,C]).then(function(w){var x=m(w[0],w[1],w[2],w[3]);var y=Object.keys(x);if(y.length===0){x={};}else if(y.length>1){L.error("reveal or addODataProperty action defined for more than 1 aggregation, that is not yet possible");}if(y.length>0){var z=y[0];x[z].aggregation=z;x=x[z];}i._mAddActions=i._mAddActions||{asSibling:{},asChild:{}};i._mAddActions[u]=x;r(x);}).catch(function(w){t(w);});}.bind(this));},_getActionsOrUndef:function(s,i){var r=s?"asSibling":"asChild";return i._mAddActions&&i._mAddActions[r];},_checkIfCreateFunctionIsAvailable:function(C){return!C||(C&&C.content&&C.content.createFunction);},showAvailableElements:function(i,r,I,C){var R=r[0];var s=_(i,R);var t=i&&R.getElement();var u;return this._getActions(i,R).then(function(v){u=v;}).then(function(){return this.getAllElements(i,[s.responsibleElementOverlay],I,C);}.bind(this)).then(function(v){this.getDialog().setElements(v);return this.getDialog().open().then(function(){return this._createCommands(s,t,u,I);}.bind(this)).catch(function(w){if(w instanceof Error){throw w;}});}.bind(this)).catch(function(v){if(v instanceof Error){throw v;}else{L.info("Service not up to date, skipping add dialog","sap.ui.rta");}});},_setDialogTitle:function(i,r,C){var s=h("HEADER_ADDITIONAL_ELEMENTS",i,r,g,C);this.getDialog().setTitle(s);if(C){this.getDialog()._oList.setNoDataText(this.getDialog()._oTextResources.getText("MSG_NO_FIELDS",C.toLowerCase()));}},_onOpenCustomField:function(){F.ifUShellContainerThen(function(s){var C=s[0];var H=(C&&C.hrefForExternal({target:{semanticObject:"CustomField",action:"develop"},params:{businessContexts:this._oCurrentFieldExtInfo.BusinessContexts.map(function(B){return B.BusinessContext;}),serviceName:this._oCurrentFieldExtInfo.ServiceName,serviceVersion:this._oCurrentFieldExtInfo.ServiceVersion,entityType:this._oCurrentFieldExtInfo.EntityType}}));U.openNewWindow(H);}.bind(this),["CrossApplicationNavigation"]);},_createCommands:function(i,s,r,I){var t=this.getDialog().getSelectedElements();t.sort(function(u,v){if(u.label>v.label){return-1;}if(u.label<v.label){return 1;}return 0;});if(t.length>0){return this.getCommandFactory().getCommandFor(i.parent,"composite").then(function(C){var u=Promise.resolve();t.forEach(function(v){switch(v.type){case"invisible":u=u.then(this._createCommandsForInvisibleElement.bind(this,C,v,i,s,r,I));break;case"odata":u=u.then(this._createCommandsForODataElement.bind(this,C,v,i,s,r,I));break;case"delegate":u=u.then(this._createCommandsForAddViaDelegate.bind(this,C,v,i,s,r,I));break;case"custom":u=u.then(this._createCommandsForCustomElement.bind(this,C,v,i,s,r,I));break;default:L.error("Can't create command for untreated element.type "+v.type);}},this);return u.then(function(){return C;});}.bind(this)).then(function(C){this.fireElementModified({command:C});}.bind(this)).catch(function(M){throw D.propagateError(M,"AdditionalElementsPlugin#_createCommands","Error occured during _createCommands execution","sap.ui.rta.plugin");});}return Promise.resolve();},_createCommandsForInvisibleElement:function(C,s,i,r,t,I){return this._createRevealCommandForInvisible(s,t,i).then(function(R){C.addCommand(R);return this._createMoveCommandForInvisible(s,t,i,r,I);}.bind(this)).then(function(M){if(M){C.addCommand(M);}else{L.warning("No move action configured for "+i.parent.getMetadata().getName()+", aggregation: "+t.aggregation,"sap.ui.rta");}return C;});},_waitForChangeHandlerSettings:function(i){if(i.changeHandlerSettings instanceof Promise){return i.changeHandlerSettings.then(function(s){i.changeHandlerSettings=s;return i.changeHandlerSettings;});}return Promise.resolve(i.changeHandlerSettings);},_createCommandsForODataElement:function(C,s,i,r,t,I){var u=i.parentOverlay.getAggregationOverlay(t.aggregation);var v=u.getDesignTimeMetadata();return this._waitForChangeHandlerSettings(t.addODataProperty.action).then(function(w){var R=w&&w.content&&w.content.requiredLibraries;if(R){return this._createCommandForAddLibrary(i,t,R,v).then(function(x){C.addCommand(x);});}}.bind(this)).then(this._createCommandForOData.bind(this,s,t,i,r,I)).then(function(w){C.addCommand(w);return C;});},_createCommandForOData:function(s,i,r,t,I){var u=r.parentOverlay.getAggregationOverlay(i.aggregation);var v=u.getDesignTimeMetadata();var w=i.addODataProperty.action;return this._waitForChangeHandlerSettings(w).then(function(C){var V;var x=C&&C.key&&C.key.oDataServiceVersion;var R=r.parent;if(w.changeOnRelevantContainer){R=r.relevantContainer;}var y=U.getIndex(r.parent,t,i.aggregation,v.getData().getIndex);return this.hasChangeHandler(w.changeType,R).then(function(H){if(r.parentOverlay.getVariantManagement&&H){V=r.parentOverlay.getVariantManagement();}var M=F.getAppComponentForControl(r.parent).getManifest();var z=F.getODataServiceUriFromManifest(M);return this.getCommandFactory().getCommandFor(r.parent,"addODataProperty",{newControlId:U.createFieldLabelId(R,s.entityType,s.bindingPath),index:I!==undefined?I:y,bindingString:s.bindingPath,entityType:s.entityType,parentId:r.parent.getId(),oDataServiceVersion:x,oDataServiceUri:z,propertyName:s.name},v,V);}.bind(this));}.bind(this));},_createCommandForAddLibrary:function(i,r,R,s){var C=F.getAppComponentForControl(i.relevantContainer);var M=C.getManifest();var t=M["sap.app"].id;return this.getCommandFactory().getCommandFor(i.publicParent,"addLibrary",{reference:t,parameters:{libraries:R},appComponent:C},s);},_createRevealCommandForInvisible:function(s,i,r){var R=E.getElementInstance(s.elementId);var t=O.getOverlay(R);var u=k(i,R);var v=u.designTimeMetadata;var w=u.action;if(!t){var x=q(R,r,t);t=O.getOverlay(x);}var V;if(t){V=this.getVariantManagementReference(t);}if(w.changeOnRelevantContainer){return this.getCommandFactory().getCommandFor(R,"reveal",{revealedElementId:R.getId(),directParent:r.parent},v,V);}return this.getCommandFactory().getCommandFor(R,"reveal",{},v,V);},_createMoveCommandForInvisible:function(s,i,r,t,I){var R=E.getElementInstance(s.elementId);var u=O.getOverlay(R);var v;if(u){v=u.getParentAggregationOverlay().getAggregationName();}else{var w=k(i,R);v=w.action.getAggregationName(r.parent,R);}var x=q(R,r,u);var T=r.parent;var y=U.getIndex(r.parent,t,v);var z=U.getIndex(x,R,v)-1;y=I!==undefined?I:E.adjustIndexForMove(x,T,z,y);if(y!==z||r.parent!==R.getParent()){var B=O.getOverlay(R)?O.getOverlay(R).getParentAggregationOverlay():r.relevantContainerOverlay;var C=B.getDesignTimeMetadata();var M=C.getAction("move",R);var V;if(M){V=this.getVariantManagementReference(O.getOverlay(R));}return this.getCommandFactory().getCommandFor(r.relevantContainer,"move",{movedElements:[{element:R,sourceIndex:z,targetIndex:y}],source:{parent:x,aggregation:v},target:{parent:T,aggregation:v}},C,V);}return Promise.resolve();},_createCommandsForCustomElement:function(C,s,i,r,t,I){var u=i.parent;var v=i.parentOverlay.getAggregationOverlay(t.aggregation).getDesignTimeMetadata();var w=Object.assign({changeOnRelevantContainer:s.changeSpecificData.changeOnRelevantContainer,aggregationName:t.aggregation,changeType:s.changeSpecificData.changeType,addElementInfo:s.changeSpecificData.content,index:I||U.getIndex(i.parent,r,t.aggregation)},s.itemId&&{customItemId:s.itemId});var V;if(i.relevantContainerOverlay){V=this.getVariantManagementReference(i.relevantContainerOverlay);}return this.getCommandFactory().getCommandFor(u,"customAdd",w,v,V).then(function(x){if(x){C.addCommand(x);}return C;});},_createCommandsForAddViaDelegate:function(C,s,i,r,t,I){var u=t.addViaDelegate.action;var v=i.parentOverlay.getAggregationOverlay(t.aggregation);var w=v.getDesignTimeMetadata();var x=u.changeOnRelevantContainer?i.relevantContainer:i.parent;return this.hasChangeHandler(u.changeType,i.parent).then(function(H){var V;if(i.parentOverlay.getVariantManagement&&H){V=i.parentOverlay.getVariantManagement();}var y=U.getIndex(i.parent,r,t.aggregation,w.getData().getIndex);var z="addDelegateProperty";return this.getCommandFactory().getCommandFor(i.parent,z,{newControlId:U.createFieldLabelId(x,s.entityType,s.bindingPath),index:I!==undefined?I:y,bindingString:s.bindingPath,entityType:s.entityType,parentId:i.parent.getId(),propertyName:s.name,oDataServiceVersion:s.oDataServiceVersion,modelType:u.delegateInfo.modelType},w,V);}.bind(this)).then(function(y){if(y){C.addCommand(y);}return C;});},_isEditable:function(i,r){return Promise.all([this._isEditableCheck(r.sourceElementOverlay,true),this._isEditableCheck(r.sourceElementOverlay,false)]).then(function(s){return{asSibling:s[0],asChild:s[1]};}).catch(function(v){L.error(v);});},_isEditableCheck:function(i,r){return Promise.resolve().then(function(){var s=_(r,i,this);if(!s.relevantContainerOverlay){return false;}return this._getActions(r,i,true).then(function(t){return U.doIfAllControlsAreAvailable([i,s.parentOverlay],function(){var u=false;if(r){u=l(t,s);}if(!u&&t.reveal){u=true;}if(!u&&!r){if(t.addViaDelegate){return this.checkAggregationsOnSelf(s.parentOverlay,"add",undefined,"delegate");}else if(t.addODataProperty){return this.checkAggregationsOnSelf(s.parentOverlay,"addODataProperty");}}if(!u&&!r&&t.addViaCustom){u=true;}return u;}.bind(this));}.bind(this)).then(function(t){if(t){t=this.hasStableId(i)&&this.hasStableId(s.parentOverlay);}return t;}.bind(this));}.bind(this));},getAllElements:function(i,r,I,C){var s=r[0];var t=_(i,s,this);var u;var v=[];var w=this.getCachedElements(i);if(w){return w;}return this._getActions(i,s).then(function(x){u=x;var y=Promise.resolve([]);if(u.addViaDelegate){y=this.getAnalyzer().getUnrepresentedDelegateProperties(t.parent,u.addViaDelegate);}if(u.addODataProperty){y=this._waitForChangeHandlerSettings(u.addODataProperty.action).then(function(z){return this._checkIfCreateFunctionIsAvailable(z)?this.getAnalyzer().getUnboundODataProperties(t.parent,u.addODataProperty):[];}.bind(this));}v.push(u.reveal?this.getAnalyzer().enhanceInvisibleElements(t.parent,u):Promise.resolve([]),y,u.addViaCustom?this.getAnalyzer().getCustomAddItems(t.parent,u.addViaCustom,u.aggregation):Promise.resolve([]));if(u.aggregation||C){this._setDialogTitle(u,t.parent,C);}}.bind(this)).then(function(){if(u.addViaDelegate||u.addODataProperty){return U.isServiceUpToDate(t.parent);}}).then(function(){if(u.addViaDelegate||u.addODataProperty){return U.isExtensibilityEnabledInSystem(t.parent);}this.getDialog()._oCustomFieldButton.setVisible(false);}.bind(this)).then(function(x){if(u.addViaDelegate||u.addODataProperty){this.getDialog()._oCustomFieldButton.setVisible(x);this.getDialog().setCustomFieldEnabled(false);return U.isCustomFieldAvailable(t.parent);}}.bind(this)).then(function(x){if(x){this._oCurrentFieldExtInfo=x;this.getDialog().setCustomFieldEnabled(true);this.getDialog().addBusinessContext(this._oCurrentFieldExtInfo.BusinessContexts);this.getDialog().detachEvent('openCustomField',this._onOpenCustomField,this);this.getDialog().attachEvent('openCustomField',null,this._onOpenCustomField,this);}}.bind(this)).then(this._combineAnalyzerResults.bind(this,v)).then(function(x){this.setCachedElements(x,i);return x;}.bind(this)).catch(function(x){throw x;});},getMenuItems:function(r){var s=true;var t="CTX_ADD_ELEMENTS_AS_SIBLING";var R=20;var I="sap-icon://add";var M=[];this.clearCachedElements();return Promise.all([this.getAllElements(true,r),this.getAllElements(false,r)]).then(function(){for(var i=0;i<2;i++){if(this.isAvailable(s,r)){var G=this.getContextMenuTitle.bind(this,s);var u={id:t,text:G,handler:function(s,r){return this.showAvailableElements(s,r);}.bind(this,s),enabled:this.isEnabled.bind(this,s),rank:R,icon:I};M.push(this.enhanceItemWithResponsibleElement(u,r,["addODataProperty","reveal","custom"]));}s=false;t="CTX_ADD_ELEMENTS_AS_CHILD";R=30;}return M;}.bind(this));},_combineAnalyzerResults:function(i){return Promise.all(i).then(function(r){return this.getAnalyzer().getFilteredItemsList(r);}.bind(this));},clearCachedElements:function(){this._aCachedElements=undefined;},setCachedElements:function(i,r){this._aCachedElements=this._aCachedElements||{};this._aCachedElements[r?"asSibling":"asChild"]=i;},getCachedElements:function(i){if(!this._aCachedElements){return undefined;}return this._aCachedElements[i?"asSibling":"asChild"];}});function q(r,i,R){var s;if(R){s=R.getParentElementOverlay().getElement();}if(!s&&r.sParentId){s=sap.ui.getCore().byId(r.sParentId);}else if(!s){s=i.parent;}return s;}return A;});
