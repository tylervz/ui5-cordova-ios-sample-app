/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BaseContentRenderer","sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/ui/base/ManagedObjectObserver","sap/ui/integration/util/LoadingProvider"],function(B,C,J,M,L){"use strict";var a=C.extend("sap.ui.integration.cards.BaseContent",{metadata:{aggregations:{_content:{multiple:false,visibility:"hidden"}},events:{press:{}}},renderer:B});a.prototype.init=function(){this._iWaitingEventsCount=0;this._bReady=false;this._mObservers={};this._awaitEvent("_dataReady");this._awaitEvent("_actionContentReady");this._oLoadingProvider=new L();};a.prototype.ontap=function(e){if(!e.isMarked()){this.firePress({});}};a.prototype.exit=function(){this._oServiceManager=null;this._oDataProviderFactory=null;this._oIconFormatter=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null;}if(this._oActions){this._oActions.destroy();this._oActions=null;}if(this._oLoadingProvider){this._oLoadingProvider.destroy();this._oLoadingProvider=null;}if(this._oLoadingPlaceholder){this._oLoadingPlaceholder.destroy();this._oLoadingPlaceholder=null;}};a.prototype.loadDependencies=function(c){return Promise.resolve();};a.prototype.getActions=function(){return this._oActions;};a.prototype.setActions=function(A){this._oActions=A;};a.prototype._awaitEvent=function(e){this._iWaitingEventsCount++;this.attachEventOnce(e,function(){this._iWaitingEventsCount--;if(this._iWaitingEventsCount===0){this._bReady=true;this.fireEvent("_ready");}});};a.prototype.destroy=function(){this.setAggregation("_content",null);this.setModel(null);this._iWaitingEventsCount=0;if(this._mObservers){Object.keys(this._mObservers).forEach(function(k){this._mObservers[k].disconnect();delete this._mObservers[k];},this);}return C.prototype.destroy.apply(this,arguments);};a.prototype.setConfiguration=function(c,t){this._oConfiguration=c;if(!c){return this;}this._oLoadingPlaceholder=this._oLoadingProvider.createContentPlaceholder(c,t);this._setDataConfiguration(c.data);return this;};a.prototype.getConfiguration=function(){return this._oConfiguration;};a.prototype._setDataConfiguration=function(d){if(!d){this.fireEvent("_dataReady");return;}this.bindObject(d.path||"/");if(this._oDataProvider){this._oDataProvider.destroy();}if(this._oDataProviderFactory){this._oDataProvider=this._oDataProviderFactory.create(d,this._oServiceManager);}if(this._oDataProvider){this.setModel(new J());this._oDataProvider.attachDataRequested(function(){this.onDataRequested();}.bind(this));this._oDataProvider.attachDataChanged(function(e){this._updateModel(e.getParameter("data"));this.onDataChanged();this.onDataRequestComplete();}.bind(this));this._oDataProvider.attachError(function(e){this._handleError(e.getParameter("message"));this.onDataRequestComplete();}.bind(this));this._oDataProvider.triggerDataUpdate();}else{this.fireEvent("_dataReady");}};a.prototype.destroyPlaceholder=function(){var c=this.getAggregation("_content");if(c){c.removeStyleClass("sapFCardContentHidden");}if(this._oLoadingPlaceholder){this._oLoadingPlaceholder.destroy();this._oLoadingPlaceholder=null;}};a.prototype.onDataChanged=function(){};function _(A,c,b){var o=this.getBindingContext(),d=c.getAggregation(A);if(o){b.path=b.path||o.getPath();c.bindAggregation(A,b);if(this.getModel("parameters")&&d){this.getModel("parameters").setProperty("/visibleItems",d.length);}if(!this._mObservers[A]){this._mObservers[A]=new M(function(e){if(e.name===A&&(e.mutation==="insert"||e.mutation==="remove")){var d=c.getAggregation(A);var l=d?d.length:0;if(this.getModel("parameters")){this.getModel("parameters").setProperty("/visibleItems",l);}}}.bind(this));this._mObservers[A].observe(c,{aggregations:[A]});}}}a.prototype._bindAggregation=function(A,c,b){var d=A&&typeof A==="string";var e=b&&typeof b==="object";if(!d||!c||!e){return;}if(this.getBindingContext()){_.apply(this,arguments);}else{c.attachModelContextChange(_.bind(this,A,c,b));}};a.prototype.isReady=function(){return this._bReady;};a.prototype._updateModel=function(d){this.getModel().setData(d);};a.prototype._handleError=function(l){this.fireEvent("_error",{logMessage:l});};a.prototype.setServiceManager=function(s){this._oServiceManager=s;return this;};a.prototype.setDataProviderFactory=function(d){this._oDataProviderFactory=d;return this;};a.prototype.setIconFormatter=function(i){this._oIconFormatter=i;return this;};a.prototype.isLoading=function(){var l,c=this.getParent();l=this._oLoadingProvider;return!l.getDataProviderJSON()&&(l.getLoadingState()||c.isLoading());};a.prototype.attachPress=function(){var m=Array.prototype.slice.apply(arguments);m.unshift("press");C.prototype.attachEvent.apply(this,m);this.invalidate();return this;};a.prototype.detachPress=function(){var m=Array.prototype.slice.apply(arguments);m.unshift("press");C.prototype.detachEvent.apply(this,m);this.invalidate();return this;};a.prototype.onActionSubmitStart=function(f){};a.prototype.onActionSubmitEnd=function(r,e){};a.prototype.onDataRequested=function(){if(this._oLoadingProvider){this._oLoadingProvider.createLoadingState(this._oDataProvider);}};a.prototype.onDataRequestComplete=function(){this.fireEvent("_dataReady");this.destroyPlaceholder();};return a;});
